!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.Oidc={})}(this,function(e){"use strict";var t={}.toString,r=function(e){return t.call(e).slice(8,-1)},n="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function i(e,t){return e(t={exports:{}},t.exports),t.exports}var o=i(function(e){var t=e.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=t)}),s=o["__core-js_shared__"]||(o["__core-js_shared__"]={}),a=function(e){return s[e]||(s[e]={})},u=0,c=Math.random(),h=function(e){return"Symbol(".concat(void 0===e?"":e,")_",(++u+c).toString(36))},l=i(function(e){var t=a("wks"),r=o.Symbol,n="function"==typeof r;(e.exports=function(e){return t[e]||(t[e]=n&&r[e]||(n?r:h)("Symbol."+e))}).store=t}),d=l("toStringTag"),f="Arguments"==r(function(){return arguments}()),p=function(e){var t,n,i;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(n=function(e,t){try{return e[t]}catch(e){}}(t=Object(e),d))?n:f?r(t):"Object"==(i=r(t))&&"function"==typeof t.callee?"Arguments":i},g=function(e){return"object"==typeof e?null!==e:"function"==typeof e},v=function(e){if(!g(e))throw TypeError(e+" is not an object!");return e},_=function(e){try{return!!e()}catch(e){return!0}},y=!_(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a}),m=o.document,k=g(m)&&g(m.createElement),b=function(e){return k?m.createElement(e):{}},w=!y&&!_(function(){return 7!=Object.defineProperty(b("div"),"a",{get:function(){return 7}}).a}),S=Object.defineProperty,T={f:y?Object.defineProperty:function(e,t,r){if(v(e),t=function(e,t){if(!g(e))return e;var r,n;if(t&&"function"==typeof(r=e.toString)&&!g(n=r.call(e)))return n;if("function"==typeof(r=e.valueOf)&&!g(n=r.call(e)))return n;if(!t&&"function"==typeof(r=e.toString)&&!g(n=r.call(e)))return n;throw TypeError("Can't convert object to primitive value")}(t,!0),v(r),w)try{return S(e,t,r)}catch(e){}if("get"in r||"set"in r)throw TypeError("Accessors not supported!");return"value"in r&&(e[t]=r.value),e}},E=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}},P=y?function(e,t,r){return T.f(e,t,E(1,r))}:function(e,t,r){return e[t]=r,e},x={}.hasOwnProperty,R=function(e,t){return x.call(e,t)},O=i(function(e){var t=e.exports={version:"2.5.3"};"number"==typeof __e&&(__e=t)}),U=(O.version,i(function(e){var t=h("src"),r=Function.toString,n=(""+r).split("toString");O.inspectSource=function(e){return r.call(e)},(e.exports=function(e,r,i,s){var a="function"==typeof i;a&&(R(i,"name")||P(i,"name",r)),e[r]!==i&&(a&&(R(i,t)||P(i,t,e[r]?""+e[r]:n.join(String(r)))),e===o?e[r]=i:s?e[r]?e[r]=i:P(e,r,i):(delete e[r],P(e,r,i)))})(Function.prototype,"toString",function(){return"function"==typeof this&&this[t]||r.call(this)})})),M={};M[l("toStringTag")]="z",M+""!="[object z]"&&U(Object.prototype,"toString",function(){return"[object "+p(this)+"]"},!0);var C=Math.ceil,A=Math.floor,j=function(e){return isNaN(e=+e)?0:(e>0?A:C)(e)},I=function(e){if(void 0==e)throw TypeError("Can't call method on  "+e);return e},N=function(e){if("function"!=typeof e)throw TypeError(e+" is not a function!");return e},B=function(e,t,r){if(N(e),void 0===t)return e;switch(r){case 1:return function(r){return e.call(t,r)};case 2:return function(r,n){return e.call(t,r,n)};case 3:return function(r,n,i){return e.call(t,r,n,i)}}return function(){return e.apply(t,arguments)}},D=function(e,t,r){var n,i,s,a,u=e&D.F,c=e&D.G,h=e&D.S,l=e&D.P,d=e&D.B,f=c?o:h?o[t]||(o[t]={}):(o[t]||{}).prototype,p=c?O:O[t]||(O[t]={}),g=p.prototype||(p.prototype={});for(n in c&&(r=t),r)s=((i=!u&&f&&void 0!==f[n])?f:r)[n],a=d&&i?B(s,o):l&&"function"==typeof s?B(Function.call,s):s,f&&U(f,n,s,e&D.U),p[n]!=s&&P(p,n,a),l&&g[n]!=s&&(g[n]=s)};o.core=O,D.F=1,D.G=2,D.S=4,D.P=8,D.B=16,D.W=32,D.U=64,D.R=128;var F,q=D,L={},W=Object("z").propertyIsEnumerable(0)?Object:function(e){return"String"==r(e)?e.split(""):Object(e)},H=function(e){return W(I(e))},V=Math.min,J=function(e){return e>0?V(j(e),9007199254740991):0},K=Math.max,z=Math.min,X=a("keys"),G=function(e){return X[e]||(X[e]=h(e))},Q=(F=!1,function(e,t,r){var n,i=H(e),o=J(i.length),s=function(e,t){return(e=j(e))<0?K(e+t,0):z(e,t)}(r,o);if(F&&t!=t){for(;o>s;)if((n=i[s++])!=n)return!0}else for(;o>s;s++)if((F||s in i)&&i[s]===t)return F||s||0;return!F&&-1}),Z=G("IE_PROTO"),Y="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(","),$=Object.keys||function(e){return function(e,t){var r,n=H(e),i=0,o=[];for(r in n)r!=Z&&R(n,r)&&o.push(r);for(;t.length>i;)R(n,r=t[i++])&&(~Q(o,r)||o.push(r));return o}(e,Y)},ee=y?Object.defineProperties:function(e,t){v(e);for(var r,n=$(t),i=n.length,o=0;i>o;)T.f(e,r=n[o++],t[r]);return e},te=o.document,re=te&&te.documentElement,ne=G("IE_PROTO"),ie=function(){},oe=function(){var e,t=b("iframe"),r=Y.length;for(t.style.display="none",re.appendChild(t),t.src="javascript:",(e=t.contentWindow.document).open(),e.write("<script>document.F=Object<\/script>"),e.close(),oe=e.F;r--;)delete oe.prototype[Y[r]];return oe()},se=Object.create||function(e,t){var r;return null!==e?(ie.prototype=v(e),r=new ie,ie.prototype=null,r[ne]=e):r=oe(),void 0===t?r:ee(r,t)},ae=T.f,ue=l("toStringTag"),ce=function(e,t,r){e&&!R(e=r?e:e.prototype,ue)&&ae(e,ue,{configurable:!0,value:t})},he={};P(he,l("iterator"),function(){return this});var le,de=function(e,t,r){e.prototype=se(he,{next:E(1,r)}),ce(e,t+" Iterator")},fe=function(e){return Object(I(e))},pe=G("IE_PROTO"),ge=Object.prototype,ve=Object.getPrototypeOf||function(e){return e=fe(e),R(e,pe)?e[pe]:"function"==typeof e.constructor&&e instanceof e.constructor?e.constructor.prototype:e instanceof Object?ge:null},_e=l("iterator"),ye=!([].keys&&"next"in[].keys()),me=function(){return this},ke=function(e,t,r,n,i,o,s){de(r,t,n);var a,u,c,h=function(e){if(!ye&&e in p)return p[e];switch(e){case"keys":case"values":return function(){return new r(this,e)}}return function(){return new r(this,e)}},l=t+" Iterator",d="values"==i,f=!1,p=e.prototype,g=p[_e]||p["@@iterator"]||i&&p[i],v=!ye&&g||h(i),_=i?d?h("entries"):v:void 0,y="Array"==t&&p.entries||g;if(y&&(c=ve(y.call(new e)))!==Object.prototype&&c.next&&(ce(c,l,!0),R(c,_e)||P(c,_e,me)),d&&g&&"values"!==g.name&&(f=!0,v=function(){return g.call(this)}),(ye||f||!p[_e])&&P(p,_e,v),L[t]=v,L[l]=me,i)if(a={values:d?v:h("values"),keys:o?v:h("keys"),entries:_},s)for(u in a)u in p||U(p,u,a[u]);else q(q.P+q.F*(ye||f),t,a);return a},be=(le=!0,function(e,t){var r,n,i=String(I(e)),o=j(t),s=i.length;return o<0||o>=s?le?"":void 0:(r=i.charCodeAt(o))<55296||r>56319||o+1===s||(n=i.charCodeAt(o+1))<56320||n>57343?le?i.charAt(o):r:le?i.slice(o,o+2):n-56320+(r-55296<<10)+65536});ke(String,"String",function(e){this._t=String(e),this._i=0},function(){var e,t=this._t,r=this._i;return r>=t.length?{value:void 0,done:!0}:(e=be(t,r),this._i+=e.length,{value:e,done:!1})});var we=l("unscopables"),Se=Array.prototype;void 0==Se[we]&&P(Se,we,{});var Te=function(e){Se[we][e]=!0},Ee=function(e,t){return{value:t,done:!!e}},Pe=ke(Array,"Array",function(e,t){this._t=H(e),this._i=0,this._k=t},function(){var e=this._t,t=this._k,r=this._i++;return!e||r>=e.length?(this._t=void 0,Ee(1)):Ee(0,"keys"==t?r:"values"==t?e[r]:[r,e[r]])},"values");L.Arguments=L.Array,Te("keys"),Te("values"),Te("entries");for(var xe=l("iterator"),Re=l("toStringTag"),Oe=L.Array,Ue={CSSRuleList:!0,CSSStyleDeclaration:!1,CSSValueList:!1,ClientRectList:!1,DOMRectList:!1,DOMStringList:!1,DOMTokenList:!0,DataTransferItemList:!1,FileList:!1,HTMLAllCollection:!1,HTMLCollection:!1,HTMLFormElement:!1,HTMLSelectElement:!1,MediaList:!0,MimeTypeArray:!1,NamedNodeMap:!1,NodeList:!0,PaintRequestList:!1,Plugin:!1,PluginArray:!1,SVGLengthList:!1,SVGNumberList:!1,SVGPathSegList:!1,SVGPointList:!1,SVGStringList:!1,SVGTransformList:!1,SourceBufferList:!1,StyleSheetList:!0,TextTrackCueList:!1,TextTrackList:!1,TouchList:!1},Me=$(Ue),Ce=0;Ce<Me.length;Ce++){var Ae,je=Me[Ce],Ie=Ue[je],Ne=o[je],Be=Ne&&Ne.prototype;if(Be&&(Be[xe]||P(Be,xe,Oe),Be[Re]||P(Be,Re,je),L[je]=Oe,Ie))for(Ae in Pe)Be[Ae]||U(Be,Ae,Pe[Ae],!0)}var De,Fe,qe,Le=function(e,t,r,n){try{return n?t(v(r)[0],r[1]):t(r)}catch(t){var i=e.return;throw void 0!==i&&v(i.call(e)),t}},We=l("iterator"),He=Array.prototype,Ve=l("iterator"),Je=O.getIteratorMethod=function(e){if(void 0!=e)return e[Ve]||e["@@iterator"]||L[p(e)]},Ke=i(function(e){var t={},r={},n=e.exports=function(e,n,i,o,s){var a,u,c,h,l,d=s?function(){return e}:Je(e),f=B(i,o,n?2:1),p=0;if("function"!=typeof d)throw TypeError(e+" is not iterable!");if(void 0===(l=d)||L.Array!==l&&He[We]!==l){for(c=d.call(e);!(u=c.next()).done;)if((h=Le(c,f,u.value,n))===t||h===r)return h}else for(a=J(e.length);a>p;p++)if((h=n?f(v(u=e[p])[0],u[1]):f(e[p]))===t||h===r)return h};n.BREAK=t,n.RETURN=r}),ze=l("species"),Xe=function(e,t,r){var n=void 0===r;switch(t.length){case 0:return n?e():e.call(r);case 1:return n?e(t[0]):e.call(r,t[0]);case 2:return n?e(t[0],t[1]):e.call(r,t[0],t[1]);case 3:return n?e(t[0],t[1],t[2]):e.call(r,t[0],t[1],t[2]);case 4:return n?e(t[0],t[1],t[2],t[3]):e.call(r,t[0],t[1],t[2],t[3])}return e.apply(r,t)},Ge=o.process,Qe=o.setImmediate,Ze=o.clearImmediate,Ye=o.MessageChannel,$e=o.Dispatch,et=0,tt={},rt=function(){var e=+this;if(tt.hasOwnProperty(e)){var t=tt[e];delete tt[e],t()}},nt=function(e){rt.call(e.data)};Qe&&Ze||(Qe=function(e){for(var t=[],r=1;arguments.length>r;)t.push(arguments[r++]);return tt[++et]=function(){Xe("function"==typeof e?e:Function(e),t)},De(et),et},Ze=function(e){delete tt[e]},"process"==r(Ge)?De=function(e){Ge.nextTick(B(rt,e,1))}:$e&&$e.now?De=function(e){$e.now(B(rt,e,1))}:Ye?(qe=(Fe=new Ye).port2,Fe.port1.onmessage=nt,De=B(qe.postMessage,qe,1)):o.addEventListener&&"function"==typeof postMessage&&!o.importScripts?(De=function(e){o.postMessage(e+"","*")},o.addEventListener("message",nt,!1)):De="onreadystatechange"in b("script")?function(e){re.appendChild(b("script")).onreadystatechange=function(){re.removeChild(this),rt.call(e)}}:function(e){setTimeout(B(rt,e,1),0)});var it={set:Qe,clear:Ze},ot=it.set,st=o.MutationObserver||o.WebKitMutationObserver,at=o.process,ut=o.Promise,ct="process"==r(at);var ht={f:function(e){return new function(e){var t,r;this.promise=new e(function(e,n){if(void 0!==t||void 0!==r)throw TypeError("Bad Promise constructor");t=e,r=n}),this.resolve=N(t),this.reject=N(r)}(e)}},lt=function(e){try{return{e:!1,v:e()}}catch(e){return{e:!0,v:e}}},dt=l("species"),ft=l("iterator"),pt=!1;try{[7][ft]().return=function(){pt=!0}}catch(e){}var gt,vt,_t,yt,mt=it.set,kt=function(){var e,t,r,n=function(){var n,i;for(ct&&(n=at.domain)&&n.exit();e;){i=e.fn,e=e.next;try{i()}catch(n){throw e?r():t=void 0,n}}t=void 0,n&&n.enter()};if(ct)r=function(){at.nextTick(n)};else if(!st||o.navigator&&o.navigator.standalone)if(ut&&ut.resolve){var i=ut.resolve();r=function(){i.then(n)}}else r=function(){ot.call(o,n)};else{var s=!0,a=document.createTextNode("");new st(n).observe(a,{characterData:!0}),r=function(){a.data=s=!s}}return function(n){var i={fn:n,next:void 0};t&&(t.next=i),e||(e=i,r()),t=i}}(),bt=o.TypeError,wt=o.process,St=o.Promise,Tt="process"==p(wt),Et=function(){},Pt=vt=ht.f,xt=!!function(){try{var e=St.resolve(1),t=(e.constructor={})[l("species")]=function(e){e(Et,Et)};return(Tt||"function"==typeof PromiseRejectionEvent)&&e.then(Et)instanceof t}catch(e){}}(),Rt=function(e){var t;return!(!g(e)||"function"!=typeof(t=e.then))&&t},Ot=function(e,t){if(!e._n){e._n=!0;var r=e._c;kt(function(){for(var n=e._v,i=1==e._s,o=0,s=function(t){var r,o,s=i?t.ok:t.fail,a=t.resolve,u=t.reject,c=t.domain;try{s?(i||(2==e._h&&Ct(e),e._h=1),!0===s?r=n:(c&&c.enter(),r=s(n),c&&c.exit()),r===t.promise?u(bt("Promise-chain cycle")):(o=Rt(r))?o.call(r,a,u):a(r)):u(n)}catch(e){u(e)}};r.length>o;)s(r[o++]);e._c=[],e._n=!1,t&&!e._h&&Ut(e)})}},Ut=function(e){mt.call(o,function(){var t,r,n,i=e._v,s=Mt(e);if(s&&(t=lt(function(){Tt?wt.emit("unhandledRejection",i,e):(r=o.onunhandledrejection)?r({promise:e,reason:i}):(n=o.console)&&n.error&&n.error("Unhandled promise rejection",i)}),e._h=Tt||Mt(e)?2:1),e._a=void 0,s&&t.e)throw t.v})},Mt=function(e){return 1!==e._h&&0===(e._a||e._c).length},Ct=function(e){mt.call(o,function(){var t;Tt?wt.emit("rejectionHandled",e):(t=o.onrejectionhandled)&&t({promise:e,reason:e._v})})},At=function(e){var t=this;t._d||(t._d=!0,(t=t._w||t)._v=e,t._s=2,t._a||(t._a=t._c.slice()),Ot(t,!0))},jt=function(e){var t,r=this;if(!r._d){r._d=!0,r=r._w||r;try{if(r===e)throw bt("Promise can't be resolved itself");(t=Rt(e))?kt(function(){var n={_w:r,_d:!1};try{t.call(e,B(jt,n,1),B(At,n,1))}catch(e){At.call(n,e)}}):(r._v=e,r._s=1,Ot(r,!1))}catch(e){At.call({_w:r,_d:!1},e)}}};xt||(St=function(e){!function(e,t,r,n){if(!(e instanceof t)||void 0!==n&&n in e)throw TypeError(r+": incorrect invocation!")}(this,St,"Promise","_h"),N(e),gt.call(this);try{e(B(jt,this,1),B(At,this,1))}catch(e){At.call(this,e)}},(gt=function(e){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1}).prototype=function(e,t,r){for(var n in t)U(e,n,t[n],r);return e}(St.prototype,{then:function(e,t){var r,n,i,o=Pt((r=St,void 0===(i=v(this).constructor)||void 0==(n=v(i)[ze])?r:N(n)));return o.ok="function"!=typeof e||e,o.fail="function"==typeof t&&t,o.domain=Tt?wt.domain:void 0,this._c.push(o),this._a&&this._a.push(o),this._s&&Ot(this,!1),o.promise},catch:function(e){return this.then(void 0,e)}}),_t=function(){var e=new gt;this.promise=e,this.resolve=B(jt,e,1),this.reject=B(At,e,1)},ht.f=Pt=function(e){return e===St||e===yt?new _t(e):vt(e)}),q(q.G+q.W+q.F*!xt,{Promise:St}),ce(St,"Promise"),function(e){var t=o[e];y&&t&&!t[dt]&&T.f(t,dt,{configurable:!0,get:function(){return this}})}("Promise"),yt=O.Promise,q(q.S+q.F*!xt,"Promise",{reject:function(e){var t=Pt(this);return(0,t.reject)(e),t.promise}}),q(q.S+q.F*!xt,"Promise",{resolve:function(e){return function(e,t){if(v(e),g(t)&&t.constructor===e)return t;var r=ht.f(e);return(0,r.resolve)(t),r.promise}(this,e)}}),q(q.S+q.F*!(xt&&function(e,t){if(!t&&!pt)return!1;var r=!1;try{var n=[7],i=n[ft]();i.next=function(){return{done:r=!0}},n[ft]=function(){return i},e(n)}catch(e){}return r}(function(e){St.all(e).catch(Et)})),"Promise",{all:function(e){var t=this,r=Pt(t),n=r.resolve,i=r.reject,o=lt(function(){var r=[],o=0,s=1;Ke(e,!1,function(e){var a=o++,u=!1;r.push(void 0),s++,t.resolve(e).then(function(e){u||(u=!0,r[a]=e,--s||n(r))},i)}),--s||n(r)});return o.e&&i(o.v),r.promise},race:function(e){var t=this,r=Pt(t),n=r.reject,i=lt(function(){Ke(e,!1,function(e){t.resolve(e).then(r.resolve,n)})});return i.e&&n(i.v),r.promise}});O.Promise;var It=[].slice,Nt={},Bt=Function.bind||function(e){var t=N(this),r=It.call(arguments,1),n=function(){var i=r.concat(It.call(arguments));return this instanceof n?function(e,t,r){if(!(t in Nt)){for(var n=[],i=0;i<t;i++)n[i]="a["+i+"]";Nt[t]=Function("F,a","return new F("+n.join(",")+")")}return Nt[t](e,r)}(t,i.length,i):Xe(t,i,e)};return g(t.prototype)&&(n.prototype=t.prototype),n};q(q.P,"Function",{bind:Bt});O.Function.bind;var Dt={f:Object.getOwnPropertySymbols},Ft={f:{}.propertyIsEnumerable},qt=Object.assign,Lt=!qt||_(function(){var e={},t={},r=Symbol(),n="abcdefghijklmnopqrst";return e[r]=7,n.split("").forEach(function(e){t[e]=e}),7!=qt({},e)[r]||Object.keys(qt({},t)).join("")!=n})?function(e,t){for(var r=fe(e),n=arguments.length,i=1,o=Dt.f,s=Ft.f;n>i;)for(var a,u=W(arguments[i++]),c=o?$(u).concat(o(u)):$(u),h=c.length,l=0;h>l;)s.call(u,a=c[l++])&&(r[a]=u[a]);return r}:qt;q(q.S+q.F,"Object",{assign:Lt});O.Object.assign;var Wt=Array.isArray||function(e){return"Array"==r(e)},Ht=l("species"),Vt=function(e,t){return new(function(e){var t;return Wt(e)&&("function"!=typeof(t=e.constructor)||t!==Array&&!Wt(t.prototype)||(t=void 0),g(t)&&null===(t=t[Ht])&&(t=void 0)),void 0===t?Array:t}(e))(t)},Jt=function(e,t){var r=1==e,n=2==e,i=3==e,o=4==e,s=6==e,a=5==e||s,u=t||Vt;return function(t,c,h){for(var l,d,f=fe(t),p=W(f),g=B(c,h,3),v=J(p.length),_=0,y=r?u(t,v):n?u(t,0):void 0;v>_;_++)if((a||_ in p)&&(d=g(l=p[_],_,f),e))if(r)y[_]=d;else if(d)switch(e){case 3:return!0;case 5:return l;case 6:return _;case 2:y.push(l)}else if(o)return!1;return s?-1:i||o?o:y}},Kt=Jt(5),zt=!0;"find"in[]&&Array(1).find(function(){zt=!1}),q(q.P+q.F*zt,"Array",{find:function(e){return Kt(this,e,arguments.length>1?arguments[1]:void 0)}}),Te("find");O.Array.find;var Xt,Gt,Qt=Jt(3);q(q.P+q.F*(Gt=!0,!((Xt=[].some)&&_(function(){Gt?Xt.call(null,function(){},1):Xt.call(null)}))),"Array",{some:function(e){return Qt(this,e,arguments[1])}});O.Array.some;q(q.S,"Array",{isArray:Wt});O.Array.isArray;var Zt=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},Yt=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),$t=function e(t,r,n){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,r);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,r,n)}if("value"in i)return i.value;var s=i.get;return void 0!==s?s.call(n):void 0},er=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},tr=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},rr={debug:function(){},info:function(){},warn:function(){},error:function(){}},nr=void 0,ir=void 0,or=function(){function e(){Zt(this,e)}return Yt(e,null,[{key:"reset",value:function(){ir=3,nr=rr}},{key:"debug",value:function(){if(ir>=4){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];nr.debug.apply(nr,Array.from(t))}}},{key:"info",value:function(){if(ir>=3){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];nr.info.apply(nr,Array.from(t))}}},{key:"warn",value:function(){if(ir>=2){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];nr.warn.apply(nr,Array.from(t))}}},{key:"error",value:function(){if(ir>=1){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];nr.error.apply(nr,Array.from(t))}}},{key:"NONE",get:function(){return 0}},{key:"ERROR",get:function(){return 1}},{key:"WARN",get:function(){return 2}},{key:"INFO",get:function(){return 3}},{key:"DEBUG",get:function(){return 4}},{key:"level",get:function(){return ir},set:function(e){if(!(0<=e&&e<=4))throw new Error("Invalid log level");ir=e}},{key:"logger",get:function(){return nr},set:function(e){if(!e.debug&&e.info&&(e.debug=e.info),!(e.debug&&e.info&&e.warn&&e.error))throw new Error("Invalid logger");nr=e}}]),e}();or.reset();for(var sr={setInterval:function(e){function t(t,r){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(e,t){return setInterval(e,t)}),clearInterval:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(e){return clearInterval(e)})},ar=!1,ur=null,cr=function(){function e(){Zt(this,e)}return Yt(e,null,[{key:"_testing",value:function(){ar=!0}},{key:"setXMLHttpRequest",value:function(e){ur=e}},{key:"location",get:function(){if(!ar)return location}},{key:"localStorage",get:function(){if(!ar)return localStorage}},{key:"sessionStorage",get:function(){if(!ar)return sessionStorage}},{key:"XMLHttpRequest",get:function(){if(!ar)return ur||XMLHttpRequest}},{key:"timer",get:function(){if(!ar)return sr}}]),e}(),hr=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.prefix,n=void 0===r?"oidc.":r,i=t.store,o=void 0===i?cr.localStorage:i;Zt(this,e),this._store=o,this._prefix=n}return Yt(e,[{key:"set",value:function(e,t){return or.debug("WebStorageStateStore.set",e),e=this._prefix+e,this._store.setItem(e,t),Promise.resolve()}},{key:"get",value:function(e){or.debug("WebStorageStateStore.get",e),e=this._prefix+e;var t=this._store.getItem(e);return Promise.resolve(t)}},{key:"remove",value:function(e){or.debug("WebStorageStateStore.remove",e),e=this._prefix+e;var t=this._store.getItem(e);return this._store.removeItem(e),Promise.resolve(t)}},{key:"getAllKeys",value:function(){or.debug("WebStorageStateStore.getAllKeys");for(var e=[],t=0;t<this._store.length;t++){var r=this._store.key(t);0===r.indexOf(this._prefix)&&e.push(r.substr(this._prefix.length))}return Promise.resolve(e)}}]),e}(),lr=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:cr.XMLHttpRequest;Zt(this,e),this._XMLHttpRequest=t}return Yt(e,[{key:"getJson",value:function(e,t){var r=this;if(or.debug("JsonService.getJson",e),!e)throw or.error("No url passed"),new Error("url");return new Promise(function(n,i){var o=new r._XMLHttpRequest;o.open("GET",e),o.onload=function(){or.debug("HTTP response received, status",o.status),200===o.status?n(JSON.parse(o.responseText)):i(Error(o.statusText+" ("+o.status+")"))},o.onerror=function(){or.error("network error"),i(Error("Network Error"))},t&&(or.debug("token passed, setting Authorization header"),o.setRequestHeader("Authorization","Bearer "+t)),o.send()})}}]),e}(),dr=function(){function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:lr;if(Zt(this,e),!t)throw or.error("No settings passed to MetadataService"),new Error("settings");this._settings=t,this._jsonService=new r}return Yt(e,[{key:"getMetadata",value:function(){var e=this;return or.debug("MetadataService.getMetadata"),this._settings.metadata?(or.debug("Returning metadata from settings"),Promise.resolve(this._settings.metadata)):this.metadataUrl?(or.debug("getting metadata from",this.metadataUrl),this._jsonService.getJson(this.metadataUrl).then(function(t){return or.debug("json received"),e._settings.metadata=t,t})):(or.error("No authority or metadataUrl configured on settings"),Promise.reject(new Error("No authority or metadataUrl configured on settings")))}},{key:"getIssuer",value:function(){return or.debug("MetadataService.getIssuer"),this._getMetadataProperty("issuer")}},{key:"getAuthorizationEndpoint",value:function(){return or.debug("MetadataService.getAuthorizationEndpoint"),this._getMetadataProperty("authorization_endpoint")}},{key:"getUserInfoEndpoint",value:function(){return or.debug("MetadataService.getUserInfoEndpoint"),this._getMetadataProperty("userinfo_endpoint")}},{key:"getTokenEndpoint",value:function(){return or.debug("MetadataService.getTokenEndpoint"),this._getMetadataProperty("token_endpoint",!0)}},{key:"getCheckSessionIframe",value:function(){return or.debug("MetadataService.getCheckSessionIframe"),this._getMetadataProperty("check_session_iframe",!0)}},{key:"getEndSessionEndpoint",value:function(){return or.debug("MetadataService.getEndSessionEndpoint"),this._getMetadataProperty("end_session_endpoint",!0)}},{key:"getRevocationEndpoint",value:function(){return or.debug("MetadataService.getRevocationEndpoint"),this._getMetadataProperty("revocation_endpoint",!0)}},{key:"_getMetadataProperty",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return or.debug("MetadataService._getMetadataProperty",e),this.getMetadata().then(function(r){if(or.debug("metadata recieved"),void 0===r[e]){if(!0===t)return void or.warn("Metadata does not contain optional property "+e);throw or.error("Metadata does not contain property "+e),new Error("Metadata does not contain property "+e)}return r[e]})}},{key:"getSigningKeys",value:function(){var e=this;return or.debug("MetadataService.getSigningKeys"),this._settings.signingKeys?(or.debug("Returning signingKeys from settings"),Promise.resolve(this._settings.signingKeys)):this._getMetadataProperty("jwks_uri").then(function(t){return or.debug("jwks_uri received",t),e._jsonService.getJson(t).then(function(t){if(or.debug("key set received",t),!t.keys)throw or.error("Missing keys on keyset"),new Error("Missing keys on keyset");return e._settings.signingKeys=t.keys,e._settings.signingKeys})})}},{key:"metadataUrl",get:function(){return this._metadataUrl||(this._settings.metadataUrl?this._metadataUrl=this._settings.metadataUrl:(this._metadataUrl=this._settings.authority,this._metadataUrl&&this._metadataUrl.indexOf(".well-known/openid-configuration")<0&&("/"!==this._metadataUrl[this._metadataUrl.length-1]&&(this._metadataUrl+="/"),this._metadataUrl+=".well-known/openid-configuration"))),this._metadataUrl}}]),e}(),fr=function(){function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:lr,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:dr;if(Zt(this,e),!t)throw or.error("No settings passed to UserInfoService"),new Error("settings");this._settings=t,this._jsonService=new r,this._metadataService=new n(this._settings)}return Yt(e,[{key:"getClaims",value:function(e){var t=this;return or.debug("UserInfoService.getClaims"),e?this._metadataService.getUserInfoEndpoint().then(function(r){return or.debug("received userinfo url",r),t._jsonService.getJson(r,e).then(function(e){return or.debug("claims received",e),e})}):(or.error("No token passed"),Promise.reject(new Error("A token is required")))}}]),e}(),pr=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=e.error,n=e.error_description,i=e.error_uri,o=e.state;if(Zt(this,t),!r)throw or.error("No error passed to ErrorResponse"),new Error("error");var s=tr(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,n||r));return s.name="ErrorResponse",s.error=r,s.error_description=n,s.error_uri=i,s.state=o,s}return er(t,e),t}(Error),gr=i(function(e,t){(function(){var t;function r(e,t,r){null!=e&&("number"==typeof e?this.fromNumber(e,t,r):null==t&&"string"!=typeof e?this.fromString(e,256):this.fromString(e,t))}function n(){return new r(null)}var i="undefined"!=typeof navigator;i&&"Microsoft Internet Explorer"==navigator.appName?(r.prototype.am=function(e,t,r,n,i,o){for(var s=32767&t,a=t>>15;--o>=0;){var u=32767&this[e],c=this[e++]>>15,h=a*u+c*s;i=((u=s*u+((32767&h)<<15)+r[n]+(1073741823&i))>>>30)+(h>>>15)+a*c+(i>>>30),r[n++]=1073741823&u}return i},t=30):i&&"Netscape"!=navigator.appName?(r.prototype.am=function(e,t,r,n,i,o){for(;--o>=0;){var s=t*this[e++]+r[n]+i;i=Math.floor(s/67108864),r[n++]=67108863&s}return i},t=26):(r.prototype.am=function(e,t,r,n,i,o){for(var s=16383&t,a=t>>14;--o>=0;){var u=16383&this[e],c=this[e++]>>14,h=a*u+c*s;i=((u=s*u+((16383&h)<<14)+r[n]+i)>>28)+(h>>14)+a*c,r[n++]=268435455&u}return i},t=28),r.prototype.DB=t,r.prototype.DM=(1<<t)-1,r.prototype.DV=1<<t;r.prototype.FV=Math.pow(2,52),r.prototype.F1=52-t,r.prototype.F2=2*t-52;var o,s,a="0123456789abcdefghijklmnopqrstuvwxyz",u=new Array;for(o="0".charCodeAt(0),s=0;s<=9;++s)u[o++]=s;for(o="a".charCodeAt(0),s=10;s<36;++s)u[o++]=s;for(o="A".charCodeAt(0),s=10;s<36;++s)u[o++]=s;function c(e){return a.charAt(e)}function h(e,t){var r=u[e.charCodeAt(t)];return null==r?-1:r}function l(e){var t=n();return t.fromInt(e),t}function d(e){var t,r=1;return 0!=(t=e>>>16)&&(e=t,r+=16),0!=(t=e>>8)&&(e=t,r+=8),0!=(t=e>>4)&&(e=t,r+=4),0!=(t=e>>2)&&(e=t,r+=2),0!=(t=e>>1)&&(e=t,r+=1),r}function f(e){this.m=e}function p(e){this.m=e,this.mp=e.invDigit(),this.mpl=32767&this.mp,this.mph=this.mp>>15,this.um=(1<<e.DB-15)-1,this.mt2=2*e.t}function g(e,t){return e&t}function v(e,t){return e|t}function _(e,t){return e^t}function y(e,t){return e&~t}function m(e){if(0==e)return-1;var t=0;return 0==(65535&e)&&(e>>=16,t+=16),0==(255&e)&&(e>>=8,t+=8),0==(15&e)&&(e>>=4,t+=4),0==(3&e)&&(e>>=2,t+=2),0==(1&e)&&++t,t}function k(e){for(var t=0;0!=e;)e&=e-1,++t;return t}function b(){}function w(e){return e}function S(e){this.r2=n(),this.q3=n(),r.ONE.dlShiftTo(2*e.t,this.r2),this.mu=this.r2.divide(e),this.m=e}f.prototype.convert=function(e){return e.s<0||e.compareTo(this.m)>=0?e.mod(this.m):e},f.prototype.revert=function(e){return e},f.prototype.reduce=function(e){e.divRemTo(this.m,null,e)},f.prototype.mulTo=function(e,t,r){e.multiplyTo(t,r),this.reduce(r)},f.prototype.sqrTo=function(e,t){e.squareTo(t),this.reduce(t)},p.prototype.convert=function(e){var t=n();return e.abs().dlShiftTo(this.m.t,t),t.divRemTo(this.m,null,t),e.s<0&&t.compareTo(r.ZERO)>0&&this.m.subTo(t,t),t},p.prototype.revert=function(e){var t=n();return e.copyTo(t),this.reduce(t),t},p.prototype.reduce=function(e){for(;e.t<=this.mt2;)e[e.t++]=0;for(var t=0;t<this.m.t;++t){var r=32767&e[t],n=r*this.mpl+((r*this.mph+(e[t]>>15)*this.mpl&this.um)<<15)&e.DM;for(e[r=t+this.m.t]+=this.m.am(0,n,e,t,0,this.m.t);e[r]>=e.DV;)e[r]-=e.DV,e[++r]++}e.clamp(),e.drShiftTo(this.m.t,e),e.compareTo(this.m)>=0&&e.subTo(this.m,e)},p.prototype.mulTo=function(e,t,r){e.multiplyTo(t,r),this.reduce(r)},p.prototype.sqrTo=function(e,t){e.squareTo(t),this.reduce(t)},r.prototype.copyTo=function(e){for(var t=this.t-1;t>=0;--t)e[t]=this[t];e.t=this.t,e.s=this.s},r.prototype.fromInt=function(e){this.t=1,this.s=e<0?-1:0,e>0?this[0]=e:e<-1?this[0]=e+this.DV:this.t=0},r.prototype.fromString=function(e,t){var n;if(16==t)n=4;else if(8==t)n=3;else if(256==t)n=8;else if(2==t)n=1;else if(32==t)n=5;else{if(4!=t)return void this.fromRadix(e,t);n=2}this.t=0,this.s=0;for(var i=e.length,o=!1,s=0;--i>=0;){var a=8==n?255&e[i]:h(e,i);a<0?"-"==e.charAt(i)&&(o=!0):(o=!1,0==s?this[this.t++]=a:s+n>this.DB?(this[this.t-1]|=(a&(1<<this.DB-s)-1)<<s,this[this.t++]=a>>this.DB-s):this[this.t-1]|=a<<s,(s+=n)>=this.DB&&(s-=this.DB))}8==n&&0!=(128&e[0])&&(this.s=-1,s>0&&(this[this.t-1]|=(1<<this.DB-s)-1<<s)),this.clamp(),o&&r.ZERO.subTo(this,this)},r.prototype.clamp=function(){for(var e=this.s&this.DM;this.t>0&&this[this.t-1]==e;)--this.t},r.prototype.dlShiftTo=function(e,t){var r;for(r=this.t-1;r>=0;--r)t[r+e]=this[r];for(r=e-1;r>=0;--r)t[r]=0;t.t=this.t+e,t.s=this.s},r.prototype.drShiftTo=function(e,t){for(var r=e;r<this.t;++r)t[r-e]=this[r];t.t=Math.max(this.t-e,0),t.s=this.s},r.prototype.lShiftTo=function(e,t){var r,n=e%this.DB,i=this.DB-n,o=(1<<i)-1,s=Math.floor(e/this.DB),a=this.s<<n&this.DM;for(r=this.t-1;r>=0;--r)t[r+s+1]=this[r]>>i|a,a=(this[r]&o)<<n;for(r=s-1;r>=0;--r)t[r]=0;t[s]=a,t.t=this.t+s+1,t.s=this.s,t.clamp()},r.prototype.rShiftTo=function(e,t){t.s=this.s;var r=Math.floor(e/this.DB);if(r>=this.t)t.t=0;else{var n=e%this.DB,i=this.DB-n,o=(1<<n)-1;t[0]=this[r]>>n;for(var s=r+1;s<this.t;++s)t[s-r-1]|=(this[s]&o)<<i,t[s-r]=this[s]>>n;n>0&&(t[this.t-r-1]|=(this.s&o)<<i),t.t=this.t-r,t.clamp()}},r.prototype.subTo=function(e,t){for(var r=0,n=0,i=Math.min(e.t,this.t);r<i;)n+=this[r]-e[r],t[r++]=n&this.DM,n>>=this.DB;if(e.t<this.t){for(n-=e.s;r<this.t;)n+=this[r],t[r++]=n&this.DM,n>>=this.DB;n+=this.s}else{for(n+=this.s;r<e.t;)n-=e[r],t[r++]=n&this.DM,n>>=this.DB;n-=e.s}t.s=n<0?-1:0,n<-1?t[r++]=this.DV+n:n>0&&(t[r++]=n),t.t=r,t.clamp()},r.prototype.multiplyTo=function(e,t){var n=this.abs(),i=e.abs(),o=n.t;for(t.t=o+i.t;--o>=0;)t[o]=0;for(o=0;o<i.t;++o)t[o+n.t]=n.am(0,i[o],t,o,0,n.t);t.s=0,t.clamp(),this.s!=e.s&&r.ZERO.subTo(t,t)},r.prototype.squareTo=function(e){for(var t=this.abs(),r=e.t=2*t.t;--r>=0;)e[r]=0;for(r=0;r<t.t-1;++r){var n=t.am(r,t[r],e,2*r,0,1);(e[r+t.t]+=t.am(r+1,2*t[r],e,2*r+1,n,t.t-r-1))>=t.DV&&(e[r+t.t]-=t.DV,e[r+t.t+1]=1)}e.t>0&&(e[e.t-1]+=t.am(r,t[r],e,2*r,0,1)),e.s=0,e.clamp()},r.prototype.divRemTo=function(e,t,i){var o=e.abs();if(!(o.t<=0)){var s=this.abs();if(s.t<o.t)return null!=t&&t.fromInt(0),void(null!=i&&this.copyTo(i));null==i&&(i=n());var a=n(),u=this.s,c=e.s,h=this.DB-d(o[o.t-1]);h>0?(o.lShiftTo(h,a),s.lShiftTo(h,i)):(o.copyTo(a),s.copyTo(i));var l=a.t,f=a[l-1];if(0!=f){var p=f*(1<<this.F1)+(l>1?a[l-2]>>this.F2:0),g=this.FV/p,v=(1<<this.F1)/p,_=1<<this.F2,y=i.t,m=y-l,k=null==t?n():t;for(a.dlShiftTo(m,k),i.compareTo(k)>=0&&(i[i.t++]=1,i.subTo(k,i)),r.ONE.dlShiftTo(l,k),k.subTo(a,a);a.t<l;)a[a.t++]=0;for(;--m>=0;){var b=i[--y]==f?this.DM:Math.floor(i[y]*g+(i[y-1]+_)*v);if((i[y]+=a.am(0,b,i,m,0,l))<b)for(a.dlShiftTo(m,k),i.subTo(k,i);i[y]<--b;)i.subTo(k,i)}null!=t&&(i.drShiftTo(l,t),u!=c&&r.ZERO.subTo(t,t)),i.t=l,i.clamp(),h>0&&i.rShiftTo(h,i),u<0&&r.ZERO.subTo(i,i)}}},r.prototype.invDigit=function(){if(this.t<1)return 0;var e=this[0];if(0==(1&e))return 0;var t=3&e;return(t=(t=(t=(t=t*(2-(15&e)*t)&15)*(2-(255&e)*t)&255)*(2-((65535&e)*t&65535))&65535)*(2-e*t%this.DV)%this.DV)>0?this.DV-t:-t},r.prototype.isEven=function(){return 0==(this.t>0?1&this[0]:this.s)},r.prototype.exp=function(e,t){if(e>4294967295||e<1)return r.ONE;var i=n(),o=n(),s=t.convert(this),a=d(e)-1;for(s.copyTo(i);--a>=0;)if(t.sqrTo(i,o),(e&1<<a)>0)t.mulTo(o,s,i);else{var u=i;i=o,o=u}return t.revert(i)},r.prototype.toString=function(e){if(this.s<0)return"-"+this.negate().toString(e);var t;if(16==e)t=4;else if(8==e)t=3;else if(2==e)t=1;else if(32==e)t=5;else{if(4!=e)return this.toRadix(e);t=2}var r,n=(1<<t)-1,i=!1,o="",s=this.t,a=this.DB-s*this.DB%t;if(s-- >0)for(a<this.DB&&(r=this[s]>>a)>0&&(i=!0,o=c(r));s>=0;)a<t?(r=(this[s]&(1<<a)-1)<<t-a,r|=this[--s]>>(a+=this.DB-t)):(r=this[s]>>(a-=t)&n,a<=0&&(a+=this.DB,--s)),r>0&&(i=!0),i&&(o+=c(r));return i?o:"0"},r.prototype.negate=function(){var e=n();return r.ZERO.subTo(this,e),e},r.prototype.abs=function(){return this.s<0?this.negate():this},r.prototype.compareTo=function(e){var t=this.s-e.s;if(0!=t)return t;var r=this.t;if(0!=(t=r-e.t))return this.s<0?-t:t;for(;--r>=0;)if(0!=(t=this[r]-e[r]))return t;return 0},r.prototype.bitLength=function(){return this.t<=0?0:this.DB*(this.t-1)+d(this[this.t-1]^this.s&this.DM)},r.prototype.mod=function(e){var t=n();return this.abs().divRemTo(e,null,t),this.s<0&&t.compareTo(r.ZERO)>0&&e.subTo(t,t),t},r.prototype.modPowInt=function(e,t){var r;return r=e<256||t.isEven()?new f(t):new p(t),this.exp(e,r)},r.ZERO=l(0),r.ONE=l(1),b.prototype.convert=w,b.prototype.revert=w,b.prototype.mulTo=function(e,t,r){e.multiplyTo(t,r)},b.prototype.sqrTo=function(e,t){e.squareTo(t)},S.prototype.convert=function(e){if(e.s<0||e.t>2*this.m.t)return e.mod(this.m);if(e.compareTo(this.m)<0)return e;var t=n();return e.copyTo(t),this.reduce(t),t},S.prototype.revert=function(e){return e},S.prototype.reduce=function(e){for(e.drShiftTo(this.m.t-1,this.r2),e.t>this.m.t+1&&(e.t=this.m.t+1,e.clamp()),this.mu.multiplyUpperTo(this.r2,this.m.t+1,this.q3),this.m.multiplyLowerTo(this.q3,this.m.t+1,this.r2);e.compareTo(this.r2)<0;)e.dAddOffset(1,this.m.t+1);for(e.subTo(this.r2,e);e.compareTo(this.m)>=0;)e.subTo(this.m,e)},S.prototype.mulTo=function(e,t,r){e.multiplyTo(t,r),this.reduce(r)},S.prototype.sqrTo=function(e,t){e.squareTo(t),this.reduce(t)};var T,E,P,x=[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229,233,239,241,251,257,263,269,271,277,281,283,293,307,311,313,317,331,337,347,349,353,359,367,373,379,383,389,397,401,409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509,521,523,541,547,557,563,569,571,577,587,593,599,601,607,613,617,619,631,641,643,647,653,659,661,673,677,683,691,701,709,719,727,733,739,743,751,757,761,769,773,787,797,809,811,821,823,827,829,839,853,857,859,863,877,881,883,887,907,911,919,929,937,941,947,953,967,971,977,983,991,997],R=(1<<26)/x[x.length-1];function O(){var e;e=(new Date).getTime(),E[P++]^=255&e,E[P++]^=e>>8&255,E[P++]^=e>>16&255,E[P++]^=e>>24&255,P>=N&&(P-=N)}if(r.prototype.chunkSize=function(e){return Math.floor(Math.LN2*this.DB/Math.log(e))},r.prototype.toRadix=function(e){if(null==e&&(e=10),0==this.signum()||e<2||e>36)return"0";var t=this.chunkSize(e),r=Math.pow(e,t),i=l(r),o=n(),s=n(),a="";for(this.divRemTo(i,o,s);o.signum()>0;)a=(r+s.intValue()).toString(e).substr(1)+a,o.divRemTo(i,o,s);return s.intValue().toString(e)+a},r.prototype.fromRadix=function(e,t){this.fromInt(0),null==t&&(t=10);for(var n=this.chunkSize(t),i=Math.pow(t,n),o=!1,s=0,a=0,u=0;u<e.length;++u){var c=h(e,u);c<0?"-"==e.charAt(u)&&0==this.signum()&&(o=!0):(a=t*a+c,++s>=n&&(this.dMultiply(i),this.dAddOffset(a,0),s=0,a=0))}s>0&&(this.dMultiply(Math.pow(t,s)),this.dAddOffset(a,0)),o&&r.ZERO.subTo(this,this)},r.prototype.fromNumber=function(e,t,n){if("number"==typeof t)if(e<2)this.fromInt(1);else for(this.fromNumber(e,n),this.testBit(e-1)||this.bitwiseTo(r.ONE.shiftLeft(e-1),v,this),this.isEven()&&this.dAddOffset(1,0);!this.isProbablePrime(t);)this.dAddOffset(2,0),this.bitLength()>e&&this.subTo(r.ONE.shiftLeft(e-1),this);else{var i=new Array,o=7&e;i.length=1+(e>>3),t.nextBytes(i),o>0?i[0]&=(1<<o)-1:i[0]=0,this.fromString(i,256)}},r.prototype.bitwiseTo=function(e,t,r){var n,i,o=Math.min(e.t,this.t);for(n=0;n<o;++n)r[n]=t(this[n],e[n]);if(e.t<this.t){for(i=e.s&this.DM,n=o;n<this.t;++n)r[n]=t(this[n],i);r.t=this.t}else{for(i=this.s&this.DM,n=o;n<e.t;++n)r[n]=t(i,e[n]);r.t=e.t}r.s=t(this.s,e.s),r.clamp()},r.prototype.changeBit=function(e,t){var n=r.ONE.shiftLeft(e);return this.bitwiseTo(n,t,n),n},r.prototype.addTo=function(e,t){for(var r=0,n=0,i=Math.min(e.t,this.t);r<i;)n+=this[r]+e[r],t[r++]=n&this.DM,n>>=this.DB;if(e.t<this.t){for(n+=e.s;r<this.t;)n+=this[r],t[r++]=n&this.DM,n>>=this.DB;n+=this.s}else{for(n+=this.s;r<e.t;)n+=e[r],t[r++]=n&this.DM,n>>=this.DB;n+=e.s}t.s=n<0?-1:0,n>0?t[r++]=n:n<-1&&(t[r++]=this.DV+n),t.t=r,t.clamp()},r.prototype.dMultiply=function(e){this[this.t]=this.am(0,e-1,this,0,0,this.t),++this.t,this.clamp()},r.prototype.dAddOffset=function(e,t){if(0!=e){for(;this.t<=t;)this[this.t++]=0;for(this[t]+=e;this[t]>=this.DV;)this[t]-=this.DV,++t>=this.t&&(this[this.t++]=0),++this[t]}},r.prototype.multiplyLowerTo=function(e,t,r){var n,i=Math.min(this.t+e.t,t);for(r.s=0,r.t=i;i>0;)r[--i]=0;for(n=r.t-this.t;i<n;++i)r[i+this.t]=this.am(0,e[i],r,i,0,this.t);for(n=Math.min(e.t,t);i<n;++i)this.am(0,e[i],r,i,0,t-i);r.clamp()},r.prototype.multiplyUpperTo=function(e,t,r){--t;var n=r.t=this.t+e.t-t;for(r.s=0;--n>=0;)r[n]=0;for(n=Math.max(t-this.t,0);n<e.t;++n)r[this.t+n-t]=this.am(t-n,e[n],r,0,0,this.t+n-t);r.clamp(),r.drShiftTo(1,r)},r.prototype.modInt=function(e){if(e<=0)return 0;var t=this.DV%e,r=this.s<0?e-1:0;if(this.t>0)if(0==t)r=this[0]%e;else for(var n=this.t-1;n>=0;--n)r=(t*r+this[n])%e;return r},r.prototype.millerRabin=function(e){var t=this.subtract(r.ONE),i=t.getLowestSetBit();if(i<=0)return!1;var o=t.shiftRight(i);(e=e+1>>1)>x.length&&(e=x.length);for(var s=n(),a=0;a<e;++a){s.fromInt(x[Math.floor(Math.random()*x.length)]);var u=s.modPow(o,this);if(0!=u.compareTo(r.ONE)&&0!=u.compareTo(t)){for(var c=1;c++<i&&0!=u.compareTo(t);)if(0==(u=u.modPowInt(2,this)).compareTo(r.ONE))return!1;if(0!=u.compareTo(t))return!1}}return!0},r.prototype.clone=function(){var e=n();return this.copyTo(e),e},r.prototype.intValue=function(){if(this.s<0){if(1==this.t)return this[0]-this.DV;if(0==this.t)return-1}else{if(1==this.t)return this[0];if(0==this.t)return 0}return(this[1]&(1<<32-this.DB)-1)<<this.DB|this[0]},r.prototype.byteValue=function(){return 0==this.t?this.s:this[0]<<24>>24},r.prototype.shortValue=function(){return 0==this.t?this.s:this[0]<<16>>16},r.prototype.signum=function(){return this.s<0?-1:this.t<=0||1==this.t&&this[0]<=0?0:1},r.prototype.toByteArray=function(){var e=this.t,t=new Array;t[0]=this.s;var r,n=this.DB-e*this.DB%8,i=0;if(e-- >0)for(n<this.DB&&(r=this[e]>>n)!=(this.s&this.DM)>>n&&(t[i++]=r|this.s<<this.DB-n);e>=0;)n<8?(r=(this[e]&(1<<n)-1)<<8-n,r|=this[--e]>>(n+=this.DB-8)):(r=this[e]>>(n-=8)&255,n<=0&&(n+=this.DB,--e)),0!=(128&r)&&(r|=-256),0==i&&(128&this.s)!=(128&r)&&++i,(i>0||r!=this.s)&&(t[i++]=r);return t},r.prototype.equals=function(e){return 0==this.compareTo(e)},r.prototype.min=function(e){return this.compareTo(e)<0?this:e},r.prototype.max=function(e){return this.compareTo(e)>0?this:e},r.prototype.and=function(e){var t=n();return this.bitwiseTo(e,g,t),t},r.prototype.or=function(e){var t=n();return this.bitwiseTo(e,v,t),t},r.prototype.xor=function(e){var t=n();return this.bitwiseTo(e,_,t),t},r.prototype.andNot=function(e){var t=n();return this.bitwiseTo(e,y,t),t},r.prototype.not=function(){for(var e=n(),t=0;t<this.t;++t)e[t]=this.DM&~this[t];return e.t=this.t,e.s=~this.s,e},r.prototype.shiftLeft=function(e){var t=n();return e<0?this.rShiftTo(-e,t):this.lShiftTo(e,t),t},r.prototype.shiftRight=function(e){var t=n();return e<0?this.lShiftTo(-e,t):this.rShiftTo(e,t),t},r.prototype.getLowestSetBit=function(){for(var e=0;e<this.t;++e)if(0!=this[e])return e*this.DB+m(this[e]);return this.s<0?this.t*this.DB:-1},r.prototype.bitCount=function(){for(var e=0,t=this.s&this.DM,r=0;r<this.t;++r)e+=k(this[r]^t);return e},r.prototype.testBit=function(e){var t=Math.floor(e/this.DB);return t>=this.t?0!=this.s:0!=(this[t]&1<<e%this.DB)},r.prototype.setBit=function(e){return this.changeBit(e,v)},r.prototype.clearBit=function(e){return this.changeBit(e,y)},r.prototype.flipBit=function(e){return this.changeBit(e,_)},r.prototype.add=function(e){var t=n();return this.addTo(e,t),t},r.prototype.subtract=function(e){var t=n();return this.subTo(e,t),t},r.prototype.multiply=function(e){var t=n();return this.multiplyTo(e,t),t},r.prototype.divide=function(e){var t=n();return this.divRemTo(e,t,null),t},r.prototype.remainder=function(e){var t=n();return this.divRemTo(e,null,t),t},r.prototype.divideAndRemainder=function(e){var t=n(),r=n();return this.divRemTo(e,t,r),new Array(t,r)},r.prototype.modPow=function(e,t){var r,i,o=e.bitLength(),s=l(1);if(o<=0)return s;r=o<18?1:o<48?3:o<144?4:o<768?5:6,i=o<8?new f(t):t.isEven()?new S(t):new p(t);var a=new Array,u=3,c=r-1,h=(1<<r)-1;if(a[1]=i.convert(this),r>1){var g=n();for(i.sqrTo(a[1],g);u<=h;)a[u]=n(),i.mulTo(g,a[u-2],a[u]),u+=2}var v,_,y=e.t-1,m=!0,k=n();for(o=d(e[y])-1;y>=0;){for(o>=c?v=e[y]>>o-c&h:(v=(e[y]&(1<<o+1)-1)<<c-o,y>0&&(v|=e[y-1]>>this.DB+o-c)),u=r;0==(1&v);)v>>=1,--u;if((o-=u)<0&&(o+=this.DB,--y),m)a[v].copyTo(s),m=!1;else{for(;u>1;)i.sqrTo(s,k),i.sqrTo(k,s),u-=2;u>0?i.sqrTo(s,k):(_=s,s=k,k=_),i.mulTo(k,a[v],s)}for(;y>=0&&0==(e[y]&1<<o);)i.sqrTo(s,k),_=s,s=k,k=_,--o<0&&(o=this.DB-1,--y)}return i.revert(s)},r.prototype.modInverse=function(e){var t=e.isEven();if(this.isEven()&&t||0==e.signum())return r.ZERO;for(var n=e.clone(),i=this.clone(),o=l(1),s=l(0),a=l(0),u=l(1);0!=n.signum();){for(;n.isEven();)n.rShiftTo(1,n),t?(o.isEven()&&s.isEven()||(o.addTo(this,o),s.subTo(e,s)),o.rShiftTo(1,o)):s.isEven()||s.subTo(e,s),s.rShiftTo(1,s);for(;i.isEven();)i.rShiftTo(1,i),t?(a.isEven()&&u.isEven()||(a.addTo(this,a),u.subTo(e,u)),a.rShiftTo(1,a)):u.isEven()||u.subTo(e,u),u.rShiftTo(1,u);n.compareTo(i)>=0?(n.subTo(i,n),t&&o.subTo(a,o),s.subTo(u,s)):(i.subTo(n,i),t&&a.subTo(o,a),u.subTo(s,u))}return 0!=i.compareTo(r.ONE)?r.ZERO:u.compareTo(e)>=0?u.subtract(e):u.signum()<0?(u.addTo(e,u),u.signum()<0?u.add(e):u):u},r.prototype.pow=function(e){return this.exp(e,new b)},r.prototype.gcd=function(e){var t=this.s<0?this.negate():this.clone(),r=e.s<0?e.negate():e.clone();if(t.compareTo(r)<0){var n=t;t=r,r=n}var i=t.getLowestSetBit(),o=r.getLowestSetBit();if(o<0)return t;for(i<o&&(o=i),o>0&&(t.rShiftTo(o,t),r.rShiftTo(o,r));t.signum()>0;)(i=t.getLowestSetBit())>0&&t.rShiftTo(i,t),(i=r.getLowestSetBit())>0&&r.rShiftTo(i,r),t.compareTo(r)>=0?(t.subTo(r,t),t.rShiftTo(1,t)):(r.subTo(t,r),r.rShiftTo(1,r));return o>0&&r.lShiftTo(o,r),r},r.prototype.isProbablePrime=function(e){var t,r=this.abs();if(1==r.t&&r[0]<=x[x.length-1]){for(t=0;t<x.length;++t)if(r[0]==x[t])return!0;return!1}if(r.isEven())return!1;for(t=1;t<x.length;){for(var n=x[t],i=t+1;i<x.length&&n<R;)n*=x[i++];for(n=r.modInt(n);t<i;)if(n%x[t++]==0)return!1}return r.millerRabin(e)},r.prototype.square=function(){var e=n();return this.squareTo(e),e},r.prototype.Barrett=S,null==E){var U;if(E=new Array,P=0,"undefined"!=typeof window&&window.crypto)if(window.crypto.getRandomValues){var M=new Uint8Array(32);for(window.crypto.getRandomValues(M),U=0;U<32;++U)E[P++]=M[U]}else if("Netscape"==navigator.appName&&navigator.appVersion<"5"){var C=window.crypto.random(32);for(U=0;U<C.length;++U)E[P++]=255&C.charCodeAt(U)}for(;P<N;)U=Math.floor(65536*Math.random()),E[P++]=U>>>8,E[P++]=255&U;P=0,O()}function A(){if(null==T){for(O(),(T=new I).init(E),P=0;P<E.length;++P)E[P]=0;P=0}return T.next()}function j(){}function I(){this.i=0,this.j=0,this.S=new Array}j.prototype.nextBytes=function(e){var t;for(t=0;t<e.length;++t)e[t]=A()},I.prototype.init=function(e){var t,r,n;for(t=0;t<256;++t)this.S[t]=t;for(r=0,t=0;t<256;++t)r=r+this.S[t]+e[t%e.length]&255,n=this.S[t],this.S[t]=this.S[r],this.S[r]=n;this.i=0,this.j=0},I.prototype.next=function(){var e;return this.i=this.i+1&255,this.j=this.j+this.S[this.i]&255,e=this.S[this.i],this.S[this.i]=this.S[this.j],this.S[this.j]=e,this.S[e+this.S[this.i]&255]};var N=256;e.exports={default:r,BigInteger:r,SecureRandom:j}}).call(n)}),vr=gr.BigInteger,_r=(gr.SecureRandom,i(function(e,t){var r;e.exports=(r=r||function(e,t){var r=Object.create||function(){function e(){}return function(t){var r;return e.prototype=t,r=new e,e.prototype=null,r}}(),n={},i=n.lib={},o=i.Base={extend:function(e){var t=r(this);return e&&t.mixIn(e),t.hasOwnProperty("init")&&this.init!==t.init||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},s=i.WordArray=o.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=void 0!=t?t:4*e.length},toString:function(e){return(e||u).stringify(this)},concat:function(e){var t=this.words,r=e.words,n=this.sigBytes,i=e.sigBytes;if(this.clamp(),n%4)for(var o=0;o<i;o++){var s=r[o>>>2]>>>24-o%4*8&255;t[n+o>>>2]|=s<<24-(n+o)%4*8}else for(var o=0;o<i;o+=4)t[n+o>>>2]=r[o>>>2];return this.sigBytes+=i,this},clamp:function(){var t=this.words,r=this.sigBytes;t[r>>>2]&=4294967295<<32-r%4*8,t.length=e.ceil(r/4)},clone:function(){var e=o.clone.call(this);return e.words=this.words.slice(0),e},random:function(t){for(var r,n=[],i=function(t){var t=t,r=987654321,n=4294967295;return function(){var i=((r=36969*(65535&r)+(r>>16)&n)<<16)+(t=18e3*(65535&t)+(t>>16)&n)&n;return i/=4294967296,(i+=.5)*(e.random()>.5?1:-1)}},o=0;o<t;o+=4){var a=i(4294967296*(r||e.random()));r=987654071*a(),n.push(4294967296*a()|0)}return new s.init(n,t)}}),a=n.enc={},u=a.Hex={stringify:function(e){for(var t=e.words,r=e.sigBytes,n=[],i=0;i<r;i++){var o=t[i>>>2]>>>24-i%4*8&255;n.push((o>>>4).toString(16)),n.push((15&o).toString(16))}return n.join("")},parse:function(e){for(var t=e.length,r=[],n=0;n<t;n+=2)r[n>>>3]|=parseInt(e.substr(n,2),16)<<24-n%8*4;return new s.init(r,t/2)}},c=a.Latin1={stringify:function(e){for(var t=e.words,r=e.sigBytes,n=[],i=0;i<r;i++){var o=t[i>>>2]>>>24-i%4*8&255;n.push(String.fromCharCode(o))}return n.join("")},parse:function(e){for(var t=e.length,r=[],n=0;n<t;n++)r[n>>>2]|=(255&e.charCodeAt(n))<<24-n%4*8;return new s.init(r,t)}},h=a.Utf8={stringify:function(e){try{return decodeURIComponent(escape(c.stringify(e)))}catch(e){throw new Error("Malformed UTF-8 data")}},parse:function(e){return c.parse(unescape(encodeURIComponent(e)))}},l=i.BufferedBlockAlgorithm=o.extend({reset:function(){this._data=new s.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=h.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var r=this._data,n=r.words,i=r.sigBytes,o=this.blockSize,a=4*o,u=i/a,c=(u=t?e.ceil(u):e.max((0|u)-this._minBufferSize,0))*o,h=e.min(4*c,i);if(c){for(var l=0;l<c;l+=o)this._doProcessBlock(n,l);var d=n.splice(0,c);r.sigBytes-=h}return new s.init(d,h)},clone:function(){var e=o.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0}),d=(i.Hasher=l.extend({cfg:o.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){l.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){e&&this._append(e);var t=this._doFinalize();return t},blockSize:16,_createHelper:function(e){return function(t,r){return new e.init(r).finalize(t)}},_createHmacHelper:function(e){return function(t,r){return new d.HMAC.init(e,r).finalize(t)}}}),n.algo={});return n}(Math),r)})),yr=i(function(e,t){var r;e.exports=(r=_r,function(e){var t=r,n=t.lib,i=n.WordArray,o=n.Hasher,s=t.algo,a=[],u=[];!function(){function t(t){for(var r=e.sqrt(t),n=2;n<=r;n++)if(!(t%n))return!1;return!0}function r(e){return 4294967296*(e-(0|e))|0}for(var n=2,i=0;i<64;)t(n)&&(i<8&&(a[i]=r(e.pow(n,.5))),u[i]=r(e.pow(n,1/3)),i++),n++}();var c=[],h=s.SHA256=o.extend({_doReset:function(){this._hash=new i.init(a.slice(0))},_doProcessBlock:function(e,t){for(var r=this._hash.words,n=r[0],i=r[1],o=r[2],s=r[3],a=r[4],h=r[5],l=r[6],d=r[7],f=0;f<64;f++){if(f<16)c[f]=0|e[t+f];else{var p=c[f-15],g=(p<<25|p>>>7)^(p<<14|p>>>18)^p>>>3,v=c[f-2],_=(v<<15|v>>>17)^(v<<13|v>>>19)^v>>>10;c[f]=g+c[f-7]+_+c[f-16]}var y=n&i^n&o^i&o,m=(n<<30|n>>>2)^(n<<19|n>>>13)^(n<<10|n>>>22),k=d+((a<<26|a>>>6)^(a<<21|a>>>11)^(a<<7|a>>>25))+(a&h^~a&l)+u[f]+c[f];d=l,l=h,h=a,a=s+k|0,s=o,o=i,i=n,n=k+(m+y)|0}r[0]=r[0]+n|0,r[1]=r[1]+i|0,r[2]=r[2]+o|0,r[3]=r[3]+s|0,r[4]=r[4]+a|0,r[5]=r[5]+h|0,r[6]=r[6]+l|0,r[7]=r[7]+d|0},_doFinalize:function(){var t=this._data,r=t.words,n=8*this._nDataBytes,i=8*t.sigBytes;return r[i>>>5]|=128<<24-i%32,r[14+(i+64>>>9<<4)]=e.floor(n/4294967296),r[15+(i+64>>>9<<4)]=n,t.sigBytes=4*r.length,this._process(),this._hash},clone:function(){var e=o.clone.call(this);return e._hash=this._hash.clone(),e}});t.SHA256=o._createHelper(h),t.HmacSHA256=o._createHmacHelper(h)}(Math),r.SHA256)}),mr=function(e){return 3*e.length/4-Rr(e)},kr=function(e){var t,r,n,i,o,s=e.length;i=Rr(e),o=new Tr(3*s/4-i),r=i>0?s-4:s;var a=0;for(t=0;t<r;t+=4)n=Sr[e.charCodeAt(t)]<<18|Sr[e.charCodeAt(t+1)]<<12|Sr[e.charCodeAt(t+2)]<<6|Sr[e.charCodeAt(t+3)],o[a++]=n>>16&255,o[a++]=n>>8&255,o[a++]=255&n;2===i?(n=Sr[e.charCodeAt(t)]<<2|Sr[e.charCodeAt(t+1)]>>4,o[a++]=255&n):1===i&&(n=Sr[e.charCodeAt(t)]<<10|Sr[e.charCodeAt(t+1)]<<4|Sr[e.charCodeAt(t+2)]>>2,o[a++]=n>>8&255,o[a++]=255&n);return o},br=function(e){for(var t,r=e.length,n=r%3,i="",o=[],s=0,a=r-n;s<a;s+=16383)o.push(Or(e,s,s+16383>a?a:s+16383));1===n?(t=e[r-1],i+=wr[t>>2],i+=wr[t<<4&63],i+="=="):2===n&&(t=(e[r-2]<<8)+e[r-1],i+=wr[t>>10],i+=wr[t>>4&63],i+=wr[t<<2&63],i+="=");return o.push(i),o.join("")},wr=[],Sr=[],Tr="undefined"!=typeof Uint8Array?Uint8Array:Array,Er="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Pr=0,xr=Er.length;Pr<xr;++Pr)wr[Pr]=Er[Pr],Sr[Er.charCodeAt(Pr)]=Pr;function Rr(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");return"="===e[t-2]?2:"="===e[t-1]?1:0}function Or(e,t,r){for(var n,i,o=[],s=t;s<r;s+=3)n=(e[s]<<16&16711680)+(e[s+1]<<8&65280)+(255&e[s+2]),o.push(wr[(i=n)>>18&63]+wr[i>>12&63]+wr[i>>6&63]+wr[63&i]);return o.join("")}Sr["-".charCodeAt(0)]=62,Sr["_".charCodeAt(0)]=63;var Ur={byteLength:mr,toByteArray:kr,fromByteArray:br};"undefined"==typeof btoa&&(global.btoa=function(e){return new Buffer(e).toString("base64")}),"undefined"==typeof atob&&(global.atob=function(e){return new Buffer(e,"base64").toString()});var Mr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Cr={hexToBase64:function(e){var t,r,n="";for(t=0;t+3<=e.length;t+=3)r=parseInt(e.substring(t,t+3),16),n+=Mr.charAt(r>>6)+Mr.charAt(63&r);for(t+1==e.length?(r=parseInt(e.substring(t,t+1),16),n+=Mr.charAt(r<<2)):t+2==e.length&&(r=parseInt(e.substring(t,t+2),16),n+=Mr.charAt(r>>2)+Mr.charAt((3&r)<<4)),"=";(3&n.length)>0;)n+="=";return n},padding:function(e){var t=e.length%4;return 0===t?e:e+new Array(1+(4-t)).join("=")},byteArrayToString:function(e){for(var t="",r=0;r<e.length;r++)t+=String.fromCharCode(e[r]);return t},stringToByteArray:function(e){for(var t=new Array(e.length),r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t},byteArrayToHex:function(e){for(var t="",r=0;r<e.length;r++){var n=e[r].toString(16);t+=2===n.length?n:"0"+n}return t},encodeString:function(e){return btoa(encodeURIComponent(e).replace(/%([0-9A-F]{2})/g,function(e,t){return String.fromCharCode("0x"+t)})).replace(/\+/g,"-").replace(/\//g,"_")},decodeToString:function(e){return e=Cr.padding(e).replace(/-/g,"+").replace(/_/g,"/"),decodeURIComponent(atob(e).split("").map(function(e){return"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)}).join(""))},decodeToHEX:function(e){return Cr.byteArrayToHex(Ur.toByteArray(Cr.padding(e)))},base64ToBase64Url:function(e){return e=(e=(e=e.replace(/=/g,"")).replace(/\+/g,"-")).replace(/\//g,"_")},urlDecode:function(e){return e=e.replace(/-/g,"+").replace(/_/g,"/").replace(/\s/g," "),atob(e)}},Ar={sha1:"3021300906052b0e03021a05000414",sha224:"302d300d06096086480165030402040500041c",sha256:"3031300d060960864801650304020105000420",sha384:"3041300d060960864801650304020205000430",sha512:"3051300d060960864801650304020305000440",md2:"3020300c06082a864886f70d020205000410",md5:"3020300c06082a864886f70d020505000410",ripemd160:"3021300906052b2403020105000414"},jr={sha256:yr};function Ir(e,t){if(this.n=null,this.e=0,!(null!=e&&null!=t&&e.length>0&&t.length>0))throw new Error("Invalid key data");this.n=new vr(e,16),this.e=parseInt(t,16)}Ir.prototype.verify=function(e,t){t=(t=Cr.decodeToHEX(t)).replace(/[^0-9a-f]|[\s\n]]/gi,"");var r=new vr(t,16);if(r.bitLength()>this.n.bitLength())throw new Error("Signature does not match with the key modulus.");var n=function(e){for(var t in Ar){var r=Ar[t],n=r.length;if(e.substring(0,n)===r)return{alg:t,hash:e.substring(n)}}return[]}(r.modPowInt(this.e,this.n).toString(16).replace(/^1f+00/,""));if(0===n.length)return!1;if(!jr.hasOwnProperty(n.alg))throw new Error("Hashing algorithm is not supported.");var i=jr[n.alg](e).toString();return n.hash===i};var Nr=["RS256"];var Br={jws:{JWS:{parse:function(e){var t,r,n=e.split(".");if(3===n.length){try{t=JSON.parse(Cr.urlDecode(n[0])),r=JSON.parse(Cr.urlDecode(n[1]))}catch(e){return new Error("Token header or payload is not valid JSON")}return{headerObj:t,payloadObj:r}}},verify:function(e,t){(arguments.length>2&&void 0!==arguments[2]?arguments[2]:[]).forEach(function(e){if(-1===Nr.indexOf(e))throw new Error("Invalid signing algorithm: "+e)});var r=new Ir(t.n,t.e),n=e.split("."),i=[n[0],n[1]].join(".");return r.verify(i,n[2])}}},KeyUtil:{getKey:function(e){return"RSA"===e.kty?{e:Cr.decodeToHEX(e.e),n:Cr.decodeToHEX(e.n)}:null}},X509:{getPublicKeyFromCertPEM:function(){throw new Error("Not implemented. Use the full oidc-client library if you need support for X509.")}},crypto:{Util:{hashString:function(e,t){return(0,jr[t])(e).toString()}}},hextob64u:function(e){return e.length%2==1&&(e="0"+e),Cr.base64ToBase64Url(Cr.hexToBase64(e))}},Dr=Br.jws,Fr=Br.KeyUtil,qr=Br.X509,Lr=Br.crypto,Wr=Br.hextob64u,Hr=Br.AllowedSigningAlgs,Vr=function(){function e(){Zt(this,e)}return Yt(e,null,[{key:"parseJwt",value:function(e){or.debug("JoseUtil.parseJwt");try{var t=Dr.JWS.parse(e);return{header:t.headerObj,payload:t.payloadObj}}catch(e){or.error(e)}}},{key:"validateJwt",value:function(t,r,n,i,o,s){or.debug("JoseUtil.validateJwt");try{if("RSA"===r.kty)if(r.e&&r.n)r=Fr.getKey(r);else{if(!r.x5c||!r.x5c.length)return or.error("RSA key missing key material",r),Promise.reject(new Error("RSA key missing key material"));r=Fr.getKey(qr.getPublicKeyFromCertPEM(r.x5c[0]))}else{if("EC"!==r.kty)return or.error("Unsupported key type",r&&r.kty),Promise.reject(new Error("Unsupported key type: "+r&&r.kty));if(!(r.crv&&r.x&&r.y))return or.error("EC key missing key material",r),Promise.reject(new Error("EC key missing key material"));r=Fr.getKey(r)}return e._validateJwt(t,r,n,i,o,s)}catch(e){return or.error(e&&e.message||e),Promise.reject("JWT validation failed")}}},{key:"_validateJwt",value:function(t,r,n,i,o,s){or.debug("JoseUtil._validateJwt"),o||(o=0),s||(s=parseInt(Date.now()/1e3));var a=e.parseJwt(t).payload;if(!a.iss)return or.error("issuer was not provided"),Promise.reject(new Error("issuer was not provided"));if(a.iss!==n)return or.error("Invalid issuer in token",a.iss),Promise.reject(new Error("Invalid issuer in token: "+a.iss));if(!a.aud)return or.error("aud was not provided"),Promise.reject(new Error("aud was not provided"));if(!(a.aud===i||Array.isArray(a.aud)&&a.aud.indexOf(i)>=0))return or.error("Invalid audience in token",a.aud),Promise.reject(new Error("Invalid audience in token: "+a.aud));var u=s+o,c=s-o;if(!a.iat)return or.error("iat was not provided"),Promise.reject(new Error("iat was not provided"));if(u<a.iat)return or.error("iat is in the future",a.iat),Promise.reject(new Error("iat is in the future: "+a.iat));if(a.nbf&&u<a.nbf)return or.error("nbf is in the future",a.nbf),Promise.reject(new Error("nbf is in the future: "+a.nbf));if(!a.exp)return or.error("exp was not provided"),Promise.reject(new Error("exp was not provided"));if(a.exp<c)return or.error("exp is in the past",a.exp),Promise.reject(new Error("exp is in the past:"+a.exp));try{if(!Dr.JWS.verify(t,r,Hr))return or.error("signature validation failed"),Promise.reject(new Error("signature validation failed"))}catch(e){return or.error(e&&e.message||e),Promise.reject(new Error("signature validation failed"))}return Promise.resolve()}},{key:"hashString",value:function(e,t){or.debug("JoseUtil.hashString",e,t);try{return Lr.Util.hashString(e,t)}catch(e){or.error(e)}}},{key:"hexToBase64Url",value:function(e){or.debug("JoseUtil.hexToBase64Url",e);try{return Wr(e)}catch(e){or.error(e)}}}]),e}(),Jr=["nonce","at_hash","iat","nbf","exp","aud","iss","c_hash"],Kr=function(){function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:dr,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:fr,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Vr;if(Zt(this,e),!t)throw or.error("No settings passed to ResponseValidator"),new Error("settings");this._settings=t,this._metadataService=new r(this._settings),this._userInfoService=new n(this._settings),this._joseUtil=i}return Yt(e,[{key:"validateSigninResponse",value:function(e,t){var r=this;return or.debug("ResponseValidator.validateSigninResponse"),this._processSigninParams(e,t).then(function(t){return or.debug("state processed"),r._validateTokens(e,t).then(function(e){return or.debug("tokens validated"),r._processClaims(e).then(function(e){return or.debug("claims processed"),e})})})}},{key:"validateSignoutResponse",value:function(e,t){return or.debug("ResponseValidator.validateSignoutResponse"),e.id!==t.state?(or.error("State does not match"),Promise.reject(new Error("State does not match"))):(or.debug("state validated"),t.state=e.data,t.error?(or.warn("Response was error",t.error),Promise.reject(new pr(t))):Promise.resolve(t))}},{key:"_processSigninParams",value:function(e,t){if(or.debug("ResponseValidator._processSigninParams"),e.id!==t.state)return or.error("State does not match"),Promise.reject(new Error("State does not match"));if(!e.client_id)return or.error("No client_id on state"),Promise.reject(new Error("No client_id on state"));if(!e.authority)return or.error("No authority on state"),Promise.reject(new Error("No authority on state"));if(this._settings.authority){if(this._settings.authority&&this._settings.authority!==e.authority)return or.error("authority mismatch on settings vs. signin state"),Promise.reject(new Error("authority mismatch on settings vs. signin state"))}else this._settings.authority=e.authority;if(this._settings.client_id){if(this._settings.client_id&&this._settings.client_id!==e.client_id)return or.error("client_id mismatch on settings vs. signin state"),Promise.reject(new Error("client_id mismatch on settings vs. signin state"))}else this._settings.client_id=e.client_id;return or.debug("state validated"),t.state=e.data,t.error?(or.warn("Response was error",t.error),Promise.reject(new pr(t))):e.nonce&&!t.id_token?(or.error("Expecting id_token in response"),Promise.reject(new Error("No id_token in response"))):!e.nonce&&t.id_token?(or.error("Not expecting id_token in response"),Promise.reject(new Error("Unexpected id_token in response"))):Promise.resolve(t)}},{key:"_processClaims",value:function(e){var t=this;if(or.debug("ResponseValidator._processClaims"),e.isOpenIdConnect){if(or.debug("response is OIDC, processing claims"),e.profile=this._filterProtocolClaims(e.profile),this._settings.loadUserInfo&&e.access_token)return or.debug("loading user info"),this._userInfoService.getClaims(e.access_token).then(function(r){return or.debug("user info claims received from user info endpoint"),r.sub!==e.profile.sub?(or.error("sub from user info endpoint does not match sub in id_token"),Promise.reject(new Error("sub from user info endpoint does not match sub in id_token"))):(e.profile=t._mergeClaims(e.profile,r),or.debug("user info claims received, updated profile:",e.profile),e)});or.debug("not loading user info")}else or.debug("response is not OIDC, not processing claims");return Promise.resolve(e)}},{key:"_mergeClaims",value:function(e,t){var r=Object.assign({},e);for(var n in t){var i=t[n];Array.isArray(i)||(i=[i]);var o=!0,s=!1,a=void 0;try{for(var u,c=i[Symbol.iterator]();!(o=(u=c.next()).done);o=!0){var h=u.value;r[n]?Array.isArray(r[n])?r[n].indexOf(h)<0&&r[n].push(h):r[n]!==h&&(r[n]=[r[n],h]):r[n]=h}}catch(e){s=!0,a=e}finally{try{!o&&c.return&&c.return()}finally{if(s)throw a}}}return r}},{key:"_filterProtocolClaims",value:function(e){or.debug("ResponseValidator._filterProtocolClaims, incoming claims:",e);var t=Object.assign({},e);return this._settings._filterProtocolClaims?(Jr.forEach(function(e){delete t[e]}),or.debug("protocol claims filtered",t)):or.debug("protocol claims not filtered"),t}},{key:"_validateTokens",value:function(e,t){return or.debug("ResponseValidator._validateTokens"),t.id_token?t.access_token?(or.debug("Validating id_token and access_token"),this._validateIdTokenAndAccessToken(e,t)):(or.debug("Validating id_token"),this._validateIdToken(e,t)):(or.debug("No id_token to validate"),Promise.resolve(t))}},{key:"_validateIdTokenAndAccessToken",value:function(e,t){var r=this;return or.debug("ResponseValidator._validateIdTokenAndAccessToken"),this._validateIdToken(e,t).then(function(e){return r._validateAccessToken(e)})}},{key:"_validateIdToken",value:function(e,t){var r=this;if(or.debug("ResponseValidator._validateIdToken"),!e.nonce)return or.error("No nonce on state"),Promise.reject(new Error("No nonce on state"));var n=this._joseUtil.parseJwt(t.id_token);if(!n||!n.header||!n.payload)return or.error("Failed to parse id_token",n),Promise.reject(new Error("Failed to parse id_token"));if(e.nonce!==n.payload.nonce)return or.error("Invalid nonce in id_token"),Promise.reject(new Error("Invalid nonce in id_token"));var i=n.header.kid;return this._metadataService.getIssuer().then(function(o){return or.debug("Received issuer"),r._metadataService.getSigningKeys().then(function(s){if(!s)return or.error("No signing keys from metadata"),Promise.reject(new Error("No signing keys from metadata"));or.debug("Received signing keys");var a=void 0;if(i)a=s.filter(function(e){return e.kid===i})[0];else{if((s=r._filterByAlg(s,n.header.alg)).length>1)return or.error("No kid found in id_token and more than one key found in metadata"),Promise.reject(new Error("No kid found in id_token and more than one key found in metadata"));a=s[0]}if(!a)return or.error("No key matching kid or alg found in signing keys"),Promise.reject(new Error("No key matching kid or alg found in signing keys"));var u=e.client_id,c=r._settings.clockSkew;return or.debug("Validaing JWT; using clock skew (in seconds) of: ",c),r._joseUtil.validateJwt(t.id_token,a,o,u,c).then(function(){return or.debug("JWT validation successful"),n.payload.sub?(t.profile=n.payload,t):(or.error("No sub present in id_token"),Promise.reject(new Error("No sub present in id_token")))})})})}},{key:"_filterByAlg",value:function(e,t){or.debug("ResponseValidator._filterByAlg",t);var r=null;if(t.startsWith("RS"))r="RSA";else if(t.startsWith("PS"))r="PS";else{if(!t.startsWith("ES"))return or.debug("alg not supported: ",t),[];r="EC"}return or.debug("Looking for keys that match kty: ",r),e=e.filter(function(e){return e.kty===r}),or.debug("Number of keys that match kty: ",r,e.length),e}},{key:"_validateAccessToken",value:function(e){if(or.debug("ResponseValidator._validateAccessToken"),!e.profile)return or.error("No profile loaded from id_token"),Promise.reject(new Error("No profile loaded from id_token"));if(!e.profile.at_hash)return or.error("No at_hash in id_token"),Promise.reject(new Error("No at_hash in id_token"));if(!e.id_token)return or.error("No id_token"),Promise.reject(new Error("No id_token"));var t=this._joseUtil.parseJwt(e.id_token);if(!t||!t.header)return or.error("Failed to parse id_token",t),Promise.reject(new Error("Failed to parse id_token"));var r=t.header.alg;if(!r||5!==r.length)return or.error("Unsupported alg:",r),Promise.reject(new Error("Unsupported alg: "+r));var n=r.substr(2,3);if(!n)return or.error("Unsupported alg:",r,n),Promise.reject(new Error("Unsupported alg: "+r));if(256!==(n=parseInt(n))&&384!==n&&512!==n)return or.error("Unsupported alg:",r,n),Promise.reject(new Error("Unsupported alg: "+r));var i="sha"+n,o=this._joseUtil.hashString(e.access_token,i);if(!o)return or.error("access_token hash failed:",i),Promise.reject(new Error("Failed to validate at_hash"));var s=o.substr(0,o.length/2),a=this._joseUtil.hexToBase64Url(s);return a!==e.profile.at_hash?(or.error("Failed to validate at_hash",a,e.profile.at_hash),Promise.reject(new Error("Failed to validate at_hash"))):Promise.resolve(e)}}]),e}(),zr="id_token",Xr="openid",Gr=60,Qr=300,Zr=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.authority,n=t.metadataUrl,i=t.metadata,o=t.signingKeys,s=t.client_id,a=t.client_secret,u=t.response_type,c=void 0===u?zr:u,h=t.scope,l=void 0===h?Xr:h,d=t.redirect_uri,f=t.post_logout_redirect_uri,p=t.prompt,g=t.display,v=t.max_age,_=t.ui_locales,y=t.acr_values,m=t.resource,k=t.filterProtocolClaims,b=void 0===k||k,w=t.loadUserInfo,S=void 0===w||w,T=t.staleStateAge,E=void 0===T?Gr:T,P=t.clockSkew,x=void 0===P?Qr:P,R=t.stateStore,O=void 0===R?new hr:R,U=t.ResponseValidatorCtor,M=void 0===U?Kr:U,C=t.MetadataServiceCtor,A=void 0===C?dr:C;Zt(this,e),this._authority=r,this._metadataUrl=n,this._metadata=i,this._signingKeys=o,this._client_id=s,this._client_secret=a,this._response_type=c,this._scope=l,this._redirect_uri=d,this._post_logout_redirect_uri=f,this._prompt=p,this._display=g,this._max_age=v,this._ui_locales=_,this._acr_values=y,this._resource=m,this._filterProtocolClaims=!!b,this._loadUserInfo=!!S,this._staleStateAge=E,this._clockSkew=x,this._stateStore=O,this._validator=new M(this),this._metadataService=new A(this)}return Yt(e,[{key:"client_id",get:function(){return this._client_id},set:function(e){if(this._client_id)throw or.error("client_id has already been assigned."),new Error("client_id has already been assigned.");this._client_id=e}},{key:"client_secret",get:function(){return this._client_secret}},{key:"response_type",get:function(){return this._response_type}},{key:"scope",get:function(){return this._scope}},{key:"redirect_uri",get:function(){return this._redirect_uri}},{key:"post_logout_redirect_uri",get:function(){return this._post_logout_redirect_uri}},{key:"prompt",get:function(){return this._prompt}},{key:"display",get:function(){return this._display}},{key:"max_age",get:function(){return this._max_age}},{key:"ui_locales",get:function(){return this._ui_locales}},{key:"acr_values",get:function(){return this._acr_values}},{key:"resource",get:function(){return this._resource}},{key:"authority",get:function(){return this._authority},set:function(e){if(this._authority)throw or.error("authority has already been assigned."),new Error("authority has already been assigned.");this._authority=e}},{key:"metadataUrl",get:function(){return this._metadataUrl||(this._metadataUrl=this.authority,this._metadataUrl&&this._metadataUrl.indexOf(".well-known/openid-configuration")<0&&("/"!==this._metadataUrl[this._metadataUrl.length-1]&&(this._metadataUrl+="/"),this._metadataUrl+=".well-known/openid-configuration")),this._metadataUrl}},{key:"metadata",get:function(){return this._metadata},set:function(e){this._metadata=e}},{key:"signingKeys",get:function(){return this._signingKeys},set:function(e){this._signingKeys=e}},{key:"filterProtocolClaims",get:function(){return this._filterProtocolClaims}},{key:"loadUserInfo",get:function(){return this._loadUserInfo}},{key:"staleStateAge",get:function(){return this._staleStateAge}},{key:"clockSkew",get:function(){return this._clockSkew}},{key:"stateStore",get:function(){return this._stateStore}},{key:"validator",get:function(){return this._validator}},{key:"metadataService",get:function(){return this._metadataService}}]),e}(),Yr=function(){function e(){Zt(this,e)}return Yt(e,null,[{key:"addQueryParam",value:function(e,t,r){return e.indexOf("?")<0&&(e+="?"),"?"!==e[e.length-1]&&(e+="&"),e+=encodeURIComponent(t),e+="=",e+=encodeURIComponent(r)}},{key:"parseUrlFragment",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"#",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:cr;or.debug("UrlUtility.parseUrlFragment"),"string"!=typeof e&&(e=r.location.href);var n=e.lastIndexOf(t);n>=0&&(e=e.substr(n+1));for(var i,o={},s=/([^&=]+)=([^&]*)/g,a=0;i=s.exec(e);)if(o[decodeURIComponent(i[1])]=decodeURIComponent(i[2]),a++>50)return or.error("response exceeded expected number of parameters",e),{error:"Response exceeded expected number of parameters"};for(var u in o)return o;return{}}}]),e}();function $r(){for(var e="xxxxxxxxxxxx4xxxyxxxxxxxxxxxxxxx",t="0123456789abcdef",r=0,n="",i=0;i<e.length;i++)"-"!==e[i]&&"4"!==e[i]&&(r=16*Math.random()|0),"x"===e[i]?n+=t[r]:"y"===e[i]?(r&=3,n+=t[r|=8]):n+=e[i];return n}var en=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.id,n=t.data,i=t.created;Zt(this,e),this._id=r||$r(),this._data=n,this._created="number"==typeof i&&i>0?i:parseInt(Date.now()/1e3)}return Yt(e,[{key:"toStorageString",value:function(){return or.debug("State.toStorageString"),JSON.stringify({id:this.id,data:this.data,created:this.created})}},{key:"id",get:function(){return this._id}},{key:"data",get:function(){return this._data}},{key:"created",get:function(){return this._created}}],[{key:"fromStorageString",value:function(t){return or.debug("State.fromStorageString"),new e(JSON.parse(t))}},{key:"clearStaleState",value:function(t,r){or.debug("State.clearStaleState");var n=Date.now()/1e3-r;return t.getAllKeys().then(function(r){or.debug("got keys",r);var i=[],o=!0,s=!1,a=void 0;try{for(var u,c=function(){var r=u.value;l=t.get(r).then(function(i){var o=!1;if(i)try{var s=e.fromStorageString(i);or.debug("got item from key: ",r,s.created),s.created<=n&&(o=!0)}catch(e){or.error("Error parsing state for key",r,e.message),o=!0}else or.debug("no item in storage for key: ",r),o=!0;if(o)return or.debug("removed item for key: ",r),t.remove(r)}),i.push(l)},h=r[Symbol.iterator]();!(o=(u=h.next()).done);o=!0){var l;c()}}catch(e){s=!0,a=e}finally{try{!o&&h.return&&h.return()}finally{if(s)throw a}}return or.debug("waiting on promise count:",i.length),Promise.all(i)})}}]),e}(),tn=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=e.nonce,n=e.authority,i=e.client_id;Zt(this,t);var o=tr(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,arguments[0]));return!0===r?o._nonce=$r():r&&(o._nonce=r),o._authority=n,o._client_id=i,o}return er(t,en),Yt(t,[{key:"toStorageString",value:function(){return or.debug("SigninState.toStorageString"),JSON.stringify({id:this.id,data:this.data,created:this.created,nonce:this.nonce,authority:this.authority,client_id:this.client_id})}},{key:"nonce",get:function(){return this._nonce}},{key:"authority",get:function(){return this._authority}},{key:"client_id",get:function(){return this._client_id}}],[{key:"fromStorageString",value:function(e){return or.debug("SigninState.fromStorageString"),new t(JSON.parse(e))}}]),t}(),rn=function(){function e(t){var r=t.url,n=t.client_id,i=t.redirect_uri,o=t.response_type,s=t.scope,a=t.authority,u=t.data,c=t.prompt,h=t.display,l=t.max_age,d=t.ui_locales,f=t.id_token_hint,p=t.login_hint,g=t.acr_values,v=t.resource,_=t.request,y=t.request_uri;if(Zt(this,e),!r)throw or.error("No url passed to SigninRequest"),new Error("url");if(!n)throw or.error("No client_id passed to SigninRequest"),new Error("client_id");if(!i)throw or.error("No redirect_uri passed to SigninRequest"),new Error("redirect_uri");if(!o)throw or.error("No response_type passed to SigninRequest"),new Error("response_type");if(!s)throw or.error("No scope passed to SigninRequest"),new Error("scope");if(!a)throw or.error("No authority passed to SigninRequest"),new Error("authority");var m=e.isOidc(o);this.state=new tn({nonce:m,data:u,client_id:n,authority:a}),r=Yr.addQueryParam(r,"client_id",n),r=Yr.addQueryParam(r,"redirect_uri",i),r=Yr.addQueryParam(r,"response_type",o),r=Yr.addQueryParam(r,"scope",s),r=Yr.addQueryParam(r,"state",this.state.id),m&&(r=Yr.addQueryParam(r,"nonce",this.state.nonce));var k={prompt:c,display:h,max_age:l,ui_locales:d,id_token_hint:f,login_hint:p,acr_values:g,resource:v,request:_,request_uri:y};for(var b in k)k[b]&&(r=Yr.addQueryParam(r,b,k[b]));this.url=r}return Yt(e,null,[{key:"isOidc",value:function(e){return!!e.split(/\s+/g).filter(function(e){return"id_token"===e})[0]}},{key:"isOAuth",value:function(e){return!!e.split(/\s+/g).filter(function(e){return"token"===e})[0]}}]),e}(),nn=function(){function e(t){Zt(this,e);var r=Yr.parseUrlFragment(t,"#");this.error=r.error,this.error_description=r.error_description,this.error_uri=r.error_uri,this.state=r.state,this.id_token=r.id_token,this.session_state=r.session_state,this.access_token=r.access_token,this.token_type=r.token_type,this.scope=r.scope,this.profile=void 0;var n=parseInt(r.expires_in);if("number"==typeof n&&n>0){var i=parseInt(Date.now()/1e3);this.expires_at=i+n}}return Yt(e,[{key:"expires_in",get:function(){if(this.expires_at){var e=parseInt(Date.now()/1e3);return this.expires_at-e}}},{key:"expired",get:function(){var e=this.expires_in;if(void 0!==e)return e<=0}},{key:"scopes",get:function(){return(this.scope||"").split(" ")}},{key:"isOpenIdConnect",get:function(){return this.scopes.indexOf("openid")>=0||!!this.id_token}}]),e}(),on=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Zt(this,e),this._settings=t instanceof Zr?t:new Zr(t)}return Yt(e,[{key:"createSigninRequest",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.response_type,n=t.scope,i=t.redirect_uri,o=t.data,s=t.state,a=t.prompt,u=t.display,c=t.max_age,h=t.ui_locales,l=t.id_token_hint,d=t.login_hint,f=t.acr_values,p=t.resource,g=t.request,v=t.request_uri,_=arguments[1];or.debug("OidcClient.createSigninRequest");var y=this._settings.client_id;r=r||this._settings.response_type,n=n||this._settings.scope,i=i||this._settings.redirect_uri,a=a||this._settings.prompt,u=u||this._settings.display,c=c||this._settings.max_age,h=h||this._settings.ui_locales,f=f||this._settings.acr_values,p=p||this._settings.resource;var m=this._settings.authority;return this._metadataService.getAuthorizationEndpoint().then(function(t){or.debug("Received authorization endpoint",t);var k=new rn({url:t,client_id:y,redirect_uri:i,response_type:r,scope:n,data:o||s,authority:m,prompt:a,display:u,max_age:c,ui_locales:h,id_token_hint:l,login_hint:d,acr_values:f,resource:p,request:g,request_uri:v}),b=k.state;return(_=_||e._stateStore).set(b.id,b.toStorageString()).then(function(){return k})})}},{key:"processSigninResponse",value:function(e,t){var r=this;or.debug("OidcClient.processSigninResponse");var n=new nn(e);return n.state?(t=t||this._stateStore).remove(n.state).then(function(e){if(!e)throw or.error("No matching state found in storage"),new Error("No matching state found in storage");var t=tn.fromStorageString(e);return or.debug("Received state from storage; validating response"),r._validator.validateSigninResponse(t,n)}):(or.error("No state in response"),Promise.reject(new Error("No state in response")))}},{key:"createSignoutRequest",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.id_token_hint,n=t.data,i=t.state,o=t.post_logout_redirect_uri,s=arguments[1];return or.debug("OidcClient.createSignoutRequest"),o=o||this._settings.post_logout_redirect_uri,this._metadataService.getEndSessionEndpoint().then(function(t){if(!t)throw or.error("No end session endpoint url returned"),new Error("no end session endpoint");or.debug("Received end session endpoint",t);var a=new function e(t){var r=t.url,n=t.id_token_hint,i=t.post_logout_redirect_uri,o=t.data;if(Zt(this,e),!r)throw or.error("No url passed to SignoutRequest"),new Error("url");n&&(r=Yr.addQueryParam(r,"id_token_hint",n)),i&&(r=Yr.addQueryParam(r,"post_logout_redirect_uri",i),o&&(this.state=new en({data:o}),r=Yr.addQueryParam(r,"state",this.state.id))),this.url=r}({url:t,id_token_hint:r,post_logout_redirect_uri:o,data:n||i}),u=a.state;return u&&(or.debug("Signout request has state to persist"),(s=s||e._stateStore).set(u.id,u.toStorageString())),a})}},{key:"processSignoutResponse",value:function(e,t){var r=this;or.debug("OidcClient.processSignoutResponse");var n=new function e(t){Zt(this,e);var r=Yr.parseUrlFragment(t,"?");this.error=r.error,this.error_description=r.error_description,this.error_uri=r.error_uri,this.state=r.state}(e);if(!n.state)return or.debug("No state in response"),n.error?(or.warn("Response was error",n.error),Promise.reject(new pr(n))):Promise.resolve(n);var i=n.state;return(t=t||this._stateStore).remove(i).then(function(e){if(!e)throw or.error("No matching state found in storage"),new Error("No matching state found in storage");var t=en.fromStorageString(e);return or.debug("Received state from storage; validating response"),r._validator.validateSignoutResponse(t,n)})}},{key:"clearStaleState",value:function(e){return or.debug("OidcClient.clearStaleState"),e=e||this._stateStore,en.clearStaleState(e,this.settings.staleStateAge)}},{key:"_stateStore",get:function(){return this.settings.stateStore}},{key:"_validator",get:function(){return this.settings.validator}},{key:"_metadataService",get:function(){return this.settings.metadataService}},{key:"settings",get:function(){return this._settings}},{key:"metadataService",get:function(){return this._metadataService}}]),e}(),sn=function(){function e(){Zt(this,e),this._data={}}return Yt(e,[{key:"getItem",value:function(e){return or.debug("InMemoryWebStorage.getItem",e),this._data[e]}},{key:"setItem",value:function(e,t){or.debug("InMemoryWebStorage.setItem",e),this._data[e]=t}},{key:"removeItem",value:function(e){or.debug("InMemoryWebStorage.removeItem",e),delete this._data[e]}},{key:"key",value:function(e){return Object.getOwnPropertyNames(this._data)[e]}},{key:"length",get:function(){return Object.getOwnPropertyNames(this._data).length}}]),e}(),an=function(){function e(){Zt(this,e)}return Yt(e,[{key:"prepare",value:function(){return Promise.resolve(this)}},{key:"navigate",value:function(e){return or.debug("RedirectNavigator.navigate"),e&&e.url?(window.location=e.url,Promise.resolve()):(or.error("No url provided"),Promise.reject(new Error("No url provided")))}},{key:"url",get:function(){return or.debug("RedirectNavigator.url"),window.location.href}}]),e}(),un=500,cn="location=no,toolbar=no,width=500,height=500,left=100,top=100;",hn="_blank",ln=function(){function e(t){var r=this;Zt(this,e),or.debug("PopupWindow.ctor"),this._promise=new Promise(function(e,t){r._resolve=e,r._reject=t});var n=t.popupWindowTarget||hn,i=t.popupWindowFeatures||cn;this._popup=window.open("",n,i),this._popup&&(or.debug("popup successfully created"),this._checkForPopupClosedTimer=window.setInterval(this._checkForPopupClosed.bind(this),un))}return Yt(e,[{key:"navigate",value:function(e){return or.debug("PopupWindow.navigate"),this._popup?e&&e.url?(or.debug("Setting URL in popup"),this._id=e.id,this._id&&(window["popupCallback_"+e.id]=this._callback.bind(this)),this._popup.focus(),this._popup.window.location=e.url):this._error("No url provided"):this._error("Error opening popup window"),this.promise}},{key:"_success",value:function(e){this._cleanup(),or.debug("Successful response from popup window"),this._resolve(e)}},{key:"_error",value:function(e){this._cleanup(),or.error(e),this._reject(new Error(e))}},{key:"_cleanup",value:function(e){or.debug("PopupWindow._cleanup"),window.clearInterval(this._checkForPopupClosedTimer),this._checkForPopupClosedTimer=null,delete window["popupCallback_"+this._id],this._popup&&!e&&this._popup.close(),this._popup=null}},{key:"_checkForPopupClosed",value:function(){or.debug("PopupWindow._checkForPopupClosed"),this._popup&&!this._popup.closed||this._error("Popup window closed")}},{key:"_callback",value:function(e,t){or.debug("PopupWindow._callback"),this._cleanup(t),e?this._success({url:e}):this._error("Invalid response from popup")}},{key:"promise",get:function(){return this._promise}}],[{key:"notifyOpener",value:function(e,t,r){if(or.debug("PopupWindow.notifyOpener"),window.opener&&(e=e||window.location.href)){var n=Yr.parseUrlFragment(e,r);if(n.state){var i="popupCallback_"+n.state,o=window.opener[i];o?(or.debug("passing url message to opener"),o(e,t)):or.warn("no matching callback found on opener")}else or.warn("no state found in response url")}}}]),e}(),dn=function(){function e(){Zt(this,e)}return Yt(e,[{key:"prepare",value:function(e){var t=new ln(e);return Promise.resolve(t)}},{key:"callback",value:function(e,t,r){or.debug("PopupNavigator.callback");try{return ln.notifyOpener(e,t,r),Promise.resolve()}catch(e){return Promise.reject(e)}}}]),e}(),fn=function(){function e(t){var r=this;Zt(this,e),or.debug("IFrameWindow.ctor"),this._promise=new Promise(function(e,t){r._resolve=e,r._reject=t}),this._boundMessageEvent=this._message.bind(this),window.addEventListener("message",this._boundMessageEvent,!1),this._frame=window.document.createElement("iframe"),this._frame.style.display="none",window.document.body.appendChild(this._frame)}return Yt(e,[{key:"navigate",value:function(e){if(or.debug("IFrameWindow.navigate"),e&&e.url){var t=e.silentRequestTimeout||5e3;or.debug("Using timeout of:",t),this._timer=window.setTimeout(this._timeout.bind(this),t),this._frame.src=e.url}else this._error("No url provided");return this.promise}},{key:"_success",value:function(e){this._cleanup(),or.debug("Successful response from frame window"),this._resolve(e)}},{key:"_error",value:function(e){this._cleanup(),or.error(e),this._reject(new Error(e))}},{key:"_cleanup",value:function(){or.debug("IFrameWindow._cleanup"),window.removeEventListener("message",this._boundMessageEvent,!1),window.clearTimeout(this._timer),window.document.body.removeChild(this._frame),this._timer=null,this._frame=null,this._boundMessageEvent=null}},{key:"_timeout",value:function(){or.debug("IFrameWindow._timeout"),this._error("Frame window timed out")}},{key:"_message",value:function(e){if(or.debug("IFrameWindow._message"),this._timer&&e.origin===this._origin&&e.source===this._frame.contentWindow){var t=e.data;t?this._success({url:t}):this._error("Invalid response from frame")}}},{key:"promise",get:function(){return this._promise}},{key:"_origin",get:function(){return location.protocol+"//"+location.host}}],[{key:"notifyParent",value:function(e){or.debug("IFrameWindow.notifyParent"),window.parent&&window!==window.parent&&(e=e||window.location.href)&&(or.debug("posting url message to parent"),window.parent.postMessage(e,location.protocol+"//"+location.host))}}]),e}(),pn=function(){function e(){Zt(this,e)}return Yt(e,[{key:"prepare",value:function(e){var t=new fn(e);return Promise.resolve(t)}},{key:"callback",value:function(e){or.debug("IFrameNavigator.callback");try{return fn.notifyParent(e),Promise.resolve()}catch(e){return Promise.reject(e)}}}]),e}(),gn=60,vn=2e3,_n=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=e.popup_redirect_uri,n=e.popup_post_logout_redirect_uri,i=e.popupWindowFeatures,o=e.popupWindowTarget,s=e.silent_redirect_uri,a=e.silentRequestTimeout,u=e.automaticSilentRenew,c=void 0!==u&&u,h=e.monitorSession,l=void 0===h||h,d=e.checkSessionInterval,f=void 0===d?vn:d,p=e.revokeAccessTokenOnSignout,g=void 0!==p&&p,v=e.accessTokenExpiringNotificationTime,_=void 0===v?gn:v,y=e.redirectNavigator,m=void 0===y?new an:y,k=e.popupNavigator,b=void 0===k?new dn:k,w=e.iframeNavigator,S=void 0===w?new pn:w,T=e.userStore,E=void 0===T?new hr({store:cr.sessionStorage}):T;Zt(this,t);var P=tr(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,arguments[0]));return P._popup_redirect_uri=r,P._popup_post_logout_redirect_uri=n,P._popupWindowFeatures=i,P._popupWindowTarget=o,P._silent_redirect_uri=s,P._silentRequestTimeout=a,P._automaticSilentRenew=!!c,P._accessTokenExpiringNotificationTime=_,P._monitorSession=l,P._checkSessionInterval=f,P._revokeAccessTokenOnSignout=g,P._redirectNavigator=m,P._popupNavigator=b,P._iframeNavigator=S,P._userStore=E,P}return er(t,Zr),Yt(t,[{key:"popup_redirect_uri",get:function(){return this._popup_redirect_uri}},{key:"popup_post_logout_redirect_uri",get:function(){return this._popup_post_logout_redirect_uri}},{key:"popupWindowFeatures",get:function(){return this._popupWindowFeatures}},{key:"popupWindowTarget",get:function(){return this._popupWindowTarget}},{key:"silent_redirect_uri",get:function(){return this._silent_redirect_uri}},{key:"silentRequestTimeout",get:function(){return this._silentRequestTimeout}},{key:"automaticSilentRenew",get:function(){return!(!this.silent_redirect_uri||!this._automaticSilentRenew)}},{key:"accessTokenExpiringNotificationTime",get:function(){return this._accessTokenExpiringNotificationTime}},{key:"monitorSession",get:function(){return this._monitorSession}},{key:"checkSessionInterval",get:function(){return this._checkSessionInterval}},{key:"revokeAccessTokenOnSignout",get:function(){return this._revokeAccessTokenOnSignout}},{key:"redirectNavigator",get:function(){return this._redirectNavigator}},{key:"popupNavigator",get:function(){return this._popupNavigator}},{key:"iframeNavigator",get:function(){return this._iframeNavigator}},{key:"userStore",get:function(){return this._userStore}}]),t}(),yn=function(){function e(t){var r=t.id_token,n=t.session_state,i=t.access_token,o=t.token_type,s=t.scope,a=t.profile,u=t.expires_at,c=t.state;Zt(this,e),this.id_token=r,this.session_state=n,this.access_token=i,this.token_type=o,this.scope=s,this.profile=a,this.expires_at=u,this.state=c}return Yt(e,[{key:"toStorageString",value:function(){return or.debug("User.toStorageString"),JSON.stringify({id_token:this.id_token,session_state:this.session_state,access_token:this.access_token,token_type:this.token_type,scope:this.scope,profile:this.profile,expires_at:this.expires_at})}},{key:"expires_in",get:function(){if(this.expires_at){var e=parseInt(Date.now()/1e3);return this.expires_at-e}}},{key:"expired",get:function(){var e=this.expires_in;if(void 0!==e)return e<=0}},{key:"scopes",get:function(){return(this.scope||"").split(" ")}}],[{key:"fromStorageString",value:function(t){return or.debug("User.fromStorageString"),new e(JSON.parse(t))}}]),e}(),mn=function(){function e(t){Zt(this,e),this._name=t,this._callbacks=[]}return Yt(e,[{key:"addHandler",value:function(e){this._callbacks.push(e)}},{key:"removeHandler",value:function(e){var t=this._callbacks.findIndex(function(t){return t===e});t>=0&&this._callbacks.splice(t,1)}},{key:"raise",value:function(){or.debug("Raising event: "+this._name);var e=!0,t=!1,r=void 0;try{for(var n,i=this._callbacks[Symbol.iterator]();!(e=(n=i.next()).done);e=!0){n.value.apply(void 0,arguments)}}catch(e){t=!0,r=e}finally{try{!e&&i.return&&i.return()}finally{if(t)throw r}}}}]),e}(),kn=function(e){function t(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:cr.timer;Zt(this,t);var n=tr(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n._timer=r,n._nowFunc=function(){return Date.now()/1e3},n}return er(t,mn),Yt(t,[{key:"init",value:function(e){this.cancel(),e<=0&&(e=1),e=parseInt(e),or.debug("Timer.init timer "+this._name+" for duration:",e),this._expiration=this.now+e;var t=5;e<t&&(t=e),this._timerHandle=this._timer.setInterval(this._callback.bind(this),1e3*t)}},{key:"cancel",value:function(){this._timerHandle&&(or.debug("Timer.cancel: ",this._name),this._timer.clearInterval(this._timerHandle),this._timerHandle=null)}},{key:"_callback",value:function(){var e=this._expiration-this.now;or.debug("Timer._callback; "+this._name+" timer expires in:",e),this._expiration<=this.now&&(this.cancel(),$t(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"raise",this).call(this))}},{key:"now",get:function(){return parseInt(this._nowFunc())}}]),t}(),bn=60,wn=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.accessTokenExpiringNotificationTime,n=void 0===r?bn:r,i=t.accessTokenExpiringTimer,o=void 0===i?new kn("Access token expiring"):i,s=t.accessTokenExpiredTimer,a=void 0===s?new kn("Access token expired"):s;Zt(this,e),this._accessTokenExpiringNotificationTime=n,this._accessTokenExpiring=o,this._accessTokenExpired=a}return Yt(e,[{key:"load",value:function(e){if(or.debug("AccessTokenEvents.load"),this._cancelTimers(),e.access_token){var t=e.expires_in;if(or.debug("access token present, remaining duration:",t),t>0){var r=t-this._accessTokenExpiringNotificationTime;r<=0&&(r=1),or.debug("registering expiring timer in:",r),this._accessTokenExpiring.init(r)}var n=t+1;or.debug("registering expired timer in:",n),this._accessTokenExpired.init(n)}}},{key:"unload",value:function(){or.debug("AccessTokenEvents.unload"),this._cancelTimers()}},{key:"_cancelTimers",value:function(){or.debug("canceling existing access token timers"),this._accessTokenExpiring.cancel(),this._accessTokenExpired.cancel()}},{key:"addAccessTokenExpiring",value:function(e){this._accessTokenExpiring.addHandler(e)}},{key:"removeAccessTokenExpiring",value:function(e){this._accessTokenExpiring.removeHandler(e)}},{key:"addAccessTokenExpired",value:function(e){this._accessTokenExpired.addHandler(e)}},{key:"removeAccessTokenExpired",value:function(e){this._accessTokenExpired.removeHandler(e)}}]),e}(),Sn=function(e){function t(e){Zt(this,t);var r=tr(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r._userLoaded=new mn("User loaded"),r._userUnloaded=new mn("User unloaded"),r._silentRenewError=new mn("Silent renew error"),r._userSignedOut=new mn("User signed out"),r._userSessionChanged=new mn("User session changed"),r}return er(t,wn),Yt(t,[{key:"load",value:function(e){var r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];or.debug("UserManagerEvents.load"),$t(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"load",this).call(this,e),r&&this._userLoaded.raise(e)}},{key:"unload",value:function(){or.debug("UserManagerEvents.unload"),$t(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"unload",this).call(this),this._userUnloaded.raise()}},{key:"addUserLoaded",value:function(e){this._userLoaded.addHandler(e)}},{key:"removeUserLoaded",value:function(e){this._userLoaded.removeHandler(e)}},{key:"addUserUnloaded",value:function(e){this._userUnloaded.addHandler(e)}},{key:"removeUserUnloaded",value:function(e){this._userUnloaded.removeHandler(e)}},{key:"addSilentRenewError",value:function(e){this._silentRenewError.addHandler(e)}},{key:"removeSilentRenewError",value:function(e){this._silentRenewError.removeHandler(e)}},{key:"_raiseSilentRenewError",value:function(e){or.debug("UserManagerEvents._raiseSilentRenewError",e.message),this._silentRenewError.raise(e)}},{key:"addUserSignedOut",value:function(e){this._userSignedOut.addHandler(e)}},{key:"removeUserSignedOut",value:function(e){this._userSignedOut.removeHandler(e)}},{key:"_raiseUserSignedOut",value:function(e){or.debug("UserManagerEvents._raiseUserSignedOut"),this._userSignedOut.raise(e)}},{key:"addUserSessionChanged",value:function(e){this._userSessionChanged.addHandler(e)}},{key:"removeUserSessionChanged",value:function(e){this._userSessionChanged.removeHandler(e)}},{key:"_raiseUserSessionChanged",value:function(e){or.debug("UserManagerEvents._raiseUserSessionChanged"),this._userSessionChanged.raise(e)}}]),t}(),Tn=function(){function e(t){Zt(this,e),this._userManager=t,this._userManager.events.addAccessTokenExpiring(this._tokenExpiring.bind(this)),this._userManager.getUser().then(function(e){}).catch(function(e){or.error("Error from getUser:",e.message)})}return Yt(e,[{key:"_tokenExpiring",value:function(){var e=this;or.debug("SilentRenewService automatically renewing access token"),this._userManager.signinSilent().then(function(e){or.debug("Silent token renewal successful")},function(t){or.error("Error from signinSilent:",t.message),e._userManager.events._raiseSilentRenewError(t)})}}]),e}(),En=2e3,Pn=function(){function e(t,r,n,i){Zt(this,e),this._callback=t,this._client_id=r,this._url=n,this._interval=i||En;var o=n.indexOf("/",n.indexOf("//")+2);this._frame_origin=n.substr(0,o),this._frame=window.document.createElement("iframe"),this._frame.style.display="none",this._frame.src=n}return Yt(e,[{key:"load",value:function(){var e=this;return new Promise(function(t){e._frame.onload=function(){t()},window.document.body.appendChild(e._frame),e._boundMessageEvent=e._message.bind(e),window.addEventListener("message",e._boundMessageEvent,!1)})}},{key:"_message",value:function(e){e.origin===this._frame_origin&&e.source===this._frame.contentWindow&&("error"===e.data?(or.error("error message from check session op iframe"),this.stop()):"changed"===e.data?(or.debug("changed message from check session op iframe"),this.stop(),this._callback()):or.debug(e.data+" message from check session op iframe"))}},{key:"start",value:function(e){var t=this;this._session_state!==e&&(or.debug("CheckSessionIFrame.start"),this.stop(),this._session_state=e,this._timer=window.setInterval(function(){t._frame.contentWindow.postMessage(t._client_id+" "+t._session_state,t._frame_origin)},this._interval))}},{key:"stop",value:function(){or.debug("CheckSessionIFrame.stop"),this._session_state=null,this._timer&&(window.clearInterval(this._timer),this._timer=null)}}]),e}(),xn=function(){function e(t){var r=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Pn;if(Zt(this,e),!t)throw or.error("No user manager passed to SessionMonitor"),new Error("userManager");this._userManager=t,this._CheckSessionIFrameCtor=n,this._userManager.events.addUserLoaded(this._start.bind(this)),this._userManager.events.addUserUnloaded(this._stop.bind(this)),this._userManager.getUser().then(function(e){e&&r._start(e)}).catch(function(e){or.error("SessionMonitor ctor; error from getUser:",e.message)})}return Yt(e,[{key:"_start",value:function(e){var t=this,r=e.session_state;r&&(this._sub=e.profile.sub,this._sid=e.profile.sid,or.debug("SessionMonitor._start; session_state:",r,", sub:",this._sub),this._checkSessionIFrame?this._checkSessionIFrame.start(r):this._metadataService.getCheckSessionIframe().then(function(e){if(e){or.debug("Initializing check session iframe");var n=t._client_id,i=t._checkSessionInterval;t._checkSessionIFrame=new t._CheckSessionIFrameCtor(t._callback.bind(t),n,e,i),t._checkSessionIFrame.load().then(function(){t._checkSessionIFrame.start(r)})}else or.warn("No check session iframe found in the metadata")}).catch(function(e){or.error("Error from getCheckSessionIframe:",e.message)}))}},{key:"_stop",value:function(){or.debug("SessionMonitor._stop"),this._sub=null,this._sid=null,this._checkSessionIFrame&&this._checkSessionIFrame.stop()}},{key:"_callback",value:function(){var e=this;or.debug("SessionMonitor._callback"),this._userManager.querySessionStatus().then(function(t){var r=!0;t?t.sub===e._sub?(r=!1,e._checkSessionIFrame.start(t.session_state),t.sid===e._sid?or.debug("Same sub still logged in at OP, restarting check session iframe; session_state:",t.session_state):(or.debug("Same sub still logged in at OP, session state has changed, restarting check session iframe; session_state:",t.session_state),e._userManager.events._raiseUserSessionChanged())):or.debug("Different subject signed into OP:",t.sub):or.debug("Subject no longer signed into OP"),r&&(or.debug("SessionMonitor._callback; raising signed out event"),e._userManager.events._raiseUserSignedOut())}).catch(function(t){or.debug("Error calling queryCurrentSigninSession; raising signed out event",t.message),e._userManager.events._raiseUserSignedOut()})}},{key:"_settings",get:function(){return this._userManager.settings}},{key:"_metadataService",get:function(){return this._userManager.metadataService}},{key:"_client_id",get:function(){return this._settings.client_id}},{key:"_checkSessionInterval",get:function(){return this._settings.checkSessionInterval}}]),e}(),Rn=function(){function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:cr.XMLHttpRequest,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:dr;if(Zt(this,e),!t)throw or.error("No settings provided"),new Error("No settings provided.");this._settings=t,this._XMLHttpRequestCtor=r,this._metadataService=new n(this._settings)}return Yt(e,[{key:"revoke",value:function(e,t){var r=this;if(or.debug("TokenRevocationClient.revoke"),!e)throw or.error("No accessToken provided"),new Error("No accessToken provided.");return this._metadataService.getRevocationEndpoint().then(function(n){if(n){var i=r._settings.client_id,o=r._settings.client_secret;return r._revoke(n,i,o,e)}if(t)throw or.error("Revocation not supported"),new Error("Revocation not supported")})}},{key:"_revoke",value:function(e,t,r,n){var i=this;return or.debug("Calling revocation endpoint"),new Promise(function(o,s){var a=new i._XMLHttpRequestCtor;a.open("POST",e),a.onload=function(){or.debug("HTTP response received, status",a.status),200===a.status?o():s(Error(a.statusText+" ("+a.status+")"))};var u="client_id="+encodeURIComponent(t);r&&(u+="&client_secret="+encodeURIComponent(r)),u+="&token_type_hint="+encodeURIComponent("access_token"),u+="&token="+encodeURIComponent(n),a.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),a.send(u)})}}]),e}(),On=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Tn,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:xn,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Rn;Zt(this,t),e instanceof _n||(e=new _n(e));var o=tr(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return o._events=new Sn(e),o.settings.automaticSilentRenew&&(or.debug("automaticSilentRenew is configured, setting up silent renew"),o._silentRenewService=new r(o)),o.settings.monitorSession&&(or.debug("monitorSession is configured, setting up session monitor"),o._sessionMonitor=new n(o)),o._tokenRevocationClient=new i(o._settings),o}return er(t,on),Yt(t,[{key:"getUser",value:function(){var e=this;return or.debug("UserManager.getUser"),this._loadUser().then(function(t){return t?(or.info("user loaded"),e._events.load(t,!1),t):(or.info("user not found in storage"),null)})}},{key:"removeUser",value:function(){var e=this;return or.debug("UserManager.removeUser"),this._storeUser(null).then(function(){or.info("user removed from storage"),e._events.unload()})}},{key:"signinPopup",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};or.debug("UserManager.signinPopup");var t=e.redirect_uri||this.settings.popup_redirect_uri||this.settings.redirect_uri;return t?(e.redirect_uri=t,e.display="popup",this._signin(e,this._popupNavigator,{startUrl:t,popupWindowFeatures:e.popupWindowFeatures||this.settings.popupWindowFeatures,popupWindowTarget:e.popupWindowTarget||this.settings.popupWindowTarget}).then(function(e){return e&&(e.profile&&e.profile.sub?or.info("signinPopup successful, signed in sub: ",e.profile.sub):or.info("signinPopup successful")),e})):(or.error("No popup_redirect_uri or redirect_uri configured"),Promise.reject(new Error("No popup_redirect_uri or redirect_uri configured")))}},{key:"signinPopupCallback",value:function(e){return or.debug("UserManager.signinPopupCallback"),this._signinCallback(e,this._popupNavigator).then(function(e){return e&&(e.profile&&e.profile.sub?or.info("signinPopupCallback successful, signed in sub: ",e.profile.sub):or.info("signinPopupCallback successful")),e})}},{key:"signinSilent",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};or.debug("UserManager.signinSilent");var r=t.redirect_uri||this.settings.silent_redirect_uri;if(!r)return or.error("No silent_redirect_uri configured"),Promise.reject(new Error("No silent_redirect_uri configured"));t.redirect_uri=r,t.prompt="none";return(t.id_token_hint?Promise.resolve():this._loadUser().then(function(e){t.id_token_hint=e&&e.id_token})).then(function(){return e._signin(t,e._iframeNavigator,{startUrl:r,silentRequestTimeout:t.silentRequestTimeout||e.settings.silentRequestTimeout})}).then(function(e){return e&&(e.profile&&e.profile.sub?or.info("signinSilent successful, signed in sub: ",e.profile.sub):or.info("signinSilent successful")),e})}},{key:"signinSilentCallback",value:function(e){return or.debug("UserManager.signinSilentCallback"),this._signinCallback(e,this._iframeNavigator).then(function(e){return e&&(e.profile&&e.profile.sub?or.info("signinSilentCallback successful, signed in sub: ",e.profile.sub):or.info("signinSilentCallback successful")),e})}},{key:"querySessionStatus",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};or.debug("UserManager.querySessionStatus");var r=t.redirect_uri||this.settings.silent_redirect_uri;return r?(t.redirect_uri=r,t.prompt="none",t.response_type="id_token",t.scope="openid",this._signinStart(t,this._iframeNavigator,{startUrl:r,silentRequestTimeout:t.silentRequestTimeout||this.settings.silentRequestTimeout}).then(function(t){return e.processSigninResponse(t.url).then(function(e){if(or.debug("got signin response"),e.session_state&&e.profile.sub&&e.profile.sid)return or.info("querySessionStatus success for sub: ",e.profile.sub),{session_state:e.session_state,sub:e.profile.sub,sid:e.profile.sid};or.info("querySessionStatus successful, user not authenticated")})})):(or.error("No silent_redirect_uri configured"),Promise.reject(new Error("No silent_redirect_uri configured")))}},{key:"_signin",value:function(e,t){var r=this,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return or.debug("_signin"),this._signinStart(e,t,n).then(function(e){return r._signinEnd(e.url)})}},{key:"_signinCallback",value:function(e,t){return or.debug("_signinCallback"),t.callback(e)}},{key:"_signout",value:function(e,t){var r=this,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return or.debug("_signout"),this._signoutStart(e,t,n).then(function(e){return r._signoutEnd(e.url)})}},{key:"signinRedirect",value:function(e){return or.debug("UserManager.signinRedirect"),this._signinStart(e,this._redirectNavigator).then(function(){or.info("signinRedirect successful")})}},{key:"signinRedirectCallback",value:function(e){return or.debug("UserManager.signinRedirectCallback"),this._signinEnd(e||this._redirectNavigator.url).then(function(e){return e&&(e.profile&&e.profile.sub?or.info("signinRedirectCallback successful, signed in sub: ",e.profile.sub):or.info("signinRedirectCallback successful")),e})}},{key:"signoutRedirect",value:function(e){return or.debug("UserManager.signoutRedirect"),this._signoutStart(e,this._redirectNavigator).then(function(){or.info("signoutRedirect successful")})}},{key:"signoutRedirectCallback",value:function(e){return or.debug("UserManager.signoutRedirectCallback"),this._signoutEnd(e||this._redirectNavigator.url).then(function(e){or.info("signoutRedirectCallback successful")})}},{key:"signoutPopup",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};or.debug("UserManager.signinPopup");var t=e.post_logout_redirect_uri||this.settings.popup_post_logout_redirect_uri||this.settings.post_logout_redirect_uri;return e.post_logout_redirect_uri=t,e.display="popup",e.post_logout_redirect_uri&&(e.state=e.state||{}),this._signout(e,this._popupNavigator,{startUrl:t,popupWindowFeatures:e.popupWindowFeatures||this.settings.popupWindowFeatures,popupWindowTarget:e.popupWindowTarget||this.settings.popupWindowTarget}).then(function(){or.info("signoutPopup successful")})}},{key:"signoutPopupCallback",value:function(e,t){void 0===t&&"boolean"==typeof e&&(e=null,t=!0),or.debug("UserManager.signoutPopupCallback");return this._popupNavigator.callback(e,t,"?").then(function(){or.info("signoutPopupCallback successful")})}},{key:"_signinStart",value:function(e,t){var r=this,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return or.debug("_signinStart"),t.prepare(n).then(function(t){return or.debug("got navigator window handle"),r.createSigninRequest(e).then(function(e){return or.debug("got signin request"),n.url=e.url,n.id=e.state.id,t.navigate(n)})})}},{key:"_signinEnd",value:function(e){var t=this;return or.debug("_signinEnd"),this.processSigninResponse(e).then(function(e){or.debug("got signin response");var r=new yn(e);return t._storeUser(r).then(function(){return or.debug("user stored"),t._events.load(r),r})})}},{key:"_signoutStart",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=this,r=arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return or.debug("_signoutStart"),r.prepare(n).then(function(r){return or.debug("got navigator window handle"),t._loadUser().then(function(i){return or.debug("loaded current user from storage"),(t._settings.revokeAccessTokenOnSignout?t._revokeInternal(i):Promise.resolve()).then(function(){var o=e.id_token_hint||i&&i.id_token;return o&&(or.debug("Setting id_token into signout request"),e.id_token_hint=o),t.removeUser().then(function(){return or.debug("user removed, creating signout request"),t.createSignoutRequest(e).then(function(e){return or.debug("got signout request"),n.url=e.url,e.state&&(n.id=e.state.id),r.navigate(n)})})})})})}},{key:"_signoutEnd",value:function(e){return or.debug("_signoutEnd"),this.processSignoutResponse(e).then(function(e){return or.debug("got signout response"),e})}},{key:"revokeAccessToken",value:function(){var e=this;return or.debug("UserManager.revokeAccessToken"),this._loadUser().then(function(t){return e._revokeInternal(t,!0).then(function(r){if(r)return or.debug("removing token properties from user and re-storing"),t.access_token=null,t.expires_at=null,t.token_type=null,e._storeUser(t).then(function(){or.debug("user stored"),e._events.load(t)})})}).then(function(){or.info("access token revoked successfully")})}},{key:"_revokeInternal",value:function(e,t){or.debug("checking if token revocation is necessary");var r=e&&e.access_token;return!r||r.indexOf(".")>=0?(or.debug("no need to revoke due to no user, token, or JWT format"),Promise.resolve(!1)):this._tokenRevocationClient.revoke(r,t).then(function(){return!0})}},{key:"_loadUser",value:function(){return or.debug("_loadUser"),this._userStore.get(this._userStoreKey).then(function(e){return e?(or.debug("user storageString loaded"),yn.fromStorageString(e)):(or.debug("no user storageString"),null)})}},{key:"_storeUser",value:function(e){if(e){or.debug("_storeUser storing user");var t=e.toStorageString();return this._userStore.set(this._userStoreKey,t)}return or.debug("_storeUser removing user storage"),this._userStore.remove(this._userStoreKey)}},{key:"_redirectNavigator",get:function(){return this.settings.redirectNavigator}},{key:"_popupNavigator",get:function(){return this.settings.popupNavigator}},{key:"_iframeNavigator",get:function(){return this.settings.iframeNavigator}},{key:"_userStore",get:function(){return this.settings.userStore}},{key:"events",get:function(){return this._events}},{key:"_userStoreKey",get:function(){return"user:"+this.settings.authority+":"+this.settings.client_id}}]),t}(),Un="location=no,toolbar=no,zoom=no",Mn="_blank",Cn=function(){function e(t){var r=this;Zt(this,e),or.debug("CordovaPopupWindow.ctor"),this._promise=new Promise(function(e,t){r._resolve=e,r._reject=t}),this.features=t.popupWindowFeatures||Un,this.target=t.popupWindowTarget||Mn,this.redirect_uri=t.startUrl,or.debug("redirect_uri: "+this.redirect_uri)}return Yt(e,[{key:"_isInAppBrowserInstalled",value:function(e){return["cordova-plugin-inappbrowser","cordova-plugin-inappbrowser.inappbrowser","org.apache.cordova.inappbrowser"].some(function(t){return e.hasOwnProperty(t)})}},{key:"navigate",value:function(e){if(or.debug("CordovaPopupWindow.navigate"),e&&e.url){if(!window.cordova)return this._error("cordova is undefined");var t=window.cordova.require("cordova/plugin_list").metadata;if(!1===this._isInAppBrowserInstalled(t))return this._error("InAppBrowser plugin not found");this._popup=cordova.InAppBrowser.open(e.url,this.target,this.features),this._popup?(or.debug("popup successfully created"),this._exitCallbackEvent=this._exitCallback.bind(this),this._loadStartCallbackEvent=this._loadStartCallback.bind(this),this._popup.addEventListener("exit",this._exitCallbackEvent,!1),this._popup.addEventListener("loadstart",this._loadStartCallbackEvent,!1)):this._error("Error opening popup window")}else this._error("No url provided");return this.promise}},{key:"_loadStartCallback",value:function(e){0===e.url.indexOf(this.redirect_uri)&&this._success({url:e.url})}},{key:"_exitCallback",value:function(e){this._error(e)}},{key:"_success",value:function(e){this._cleanup(),or.debug("Successful response from cordova popup window"),this._resolve(e)}},{key:"_error",value:function(e){this._cleanup(),or.error(e),this._reject(new Error(e))}},{key:"_cleanup",value:function(){or.debug("CordovaPopupWindow._cleanup"),this._popup&&(this._popup.removeEventListener("exit",this._exitCallbackEvent,!1),this._popup.removeEventListener("loadstart",this._loadStartCallbackEvent,!1),this._popup.close()),this._popup=null}},{key:"promise",get:function(){return this._promise}}]),e}(),An=function(){function e(){Zt(this,e)}return Yt(e,[{key:"prepare",value:function(e){var t=new Cn(e);return Promise.resolve(t)}}]),e}(),jn=function(){function e(){Zt(this,e)}return Yt(e,[{key:"prepare",value:function(e){e.popupWindowFeatures="hidden=yes";var t=new Cn(e);return Promise.resolve(t)}}]),e}(),In={Log:or,OidcClient:on,OidcClientSettings:Zr,WebStorageStateStore:hr,InMemoryWebStorage:sn,UserManager:On,AccessTokenEvents:wn,MetadataService:dr,CordovaPopupNavigator:An,CordovaIFrameNavigator:jn,CheckSessionIFrame:Pn,TokenRevocationClient:Rn,Global:cr};e.Log=or,e.OidcClient=on,e.OidcClientSettings=Zr,e.WebStorageStateStore=hr,e.InMemoryWebStorage=sn,e.UserManager=On,e.AccessTokenEvents=wn,e.MetadataService=dr,e.CordovaPopupNavigator=An,e.CordovaIFrameNavigator=jn,e.CheckSessionIFrame=Pn,e.TokenRevocationClient=Rn,e.Global=cr,e.default=In,Object.defineProperty(e,"__esModule",{value:!0})});
